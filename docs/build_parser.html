---

title: 03 build_parser Outlining a player's army, base and tech builds


keywords: fastai
sidebar: home_sidebar



nb_path: "03_build_parser.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 03_build_parser.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Setup-for-examples-and-tests">Setup for examples and tests<a class="anchor-link" href="#Setup-for-examples-and-tests"> </a></h2><p>The following code contains this module's dependencies</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">astuple</span><span class="p">,</span> <span class="n">field</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">fastcore</span> <span class="kn">import</span> <span class="n">test</span> <span class="k">as</span> <span class="n">ft</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="kn">import</span> <span class="nn">sc2reader</span>

<span class="kn">from</span> <span class="nn">sc_training</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Next, I load a test <code>Replay</code> to use as a sample, and test case in this notebook.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">rps_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;./test_replays&quot;</span><span class="p">)</span>

<span class="c1"># single_replay is the base case I use to develop the functions in this module.</span>
<span class="n">single_replay</span> <span class="o">=</span> <span class="n">sc2reader</span><span class="o">.</span><span class="n">load_replay</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">rps_path</span><span class="o">/</span><span class="s2">&quot;Jagannatha LE.SC2Replay&quot;</span><span class="p">))</span>

<span class="c1"># The following replays have various compositions of races, armies, structures,</span>
<span class="c1"># tech updates and other game elements that allow me to test and debug the functions.abs</span>
<span class="n">sing_zerg</span> <span class="o">=</span> <span class="n">sc2reader</span><span class="o">.</span><span class="n">load_replay</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">rps_path</span><span class="o">/</span><span class="s2">&quot;Oxide LE (14).SC2Replay&quot;</span><span class="p">))</span>
<span class="n">sing_protoss</span><span class="o">=</span> <span class="n">sc2reader</span><span class="o">.</span><span class="n">load_replay</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">rps_path</span><span class="o">/</span><span class="s2">&quot;Oxide LE (13).SC2Replay&quot;</span><span class="p">))</span>
<span class="n">zustates</span> <span class="o">=</span> <span class="n">sc2reader</span><span class="o">.</span><span class="n">load_replay</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">rps_path</span><span class="o">/</span><span class="s1">&#39;zustates.SC2Replay&#39;</span><span class="p">))</span>
<span class="n">tustates</span> <span class="o">=</span> <span class="n">sc2reader</span><span class="o">.</span><span class="n">load_replay</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">rps_path</span><span class="o">/</span><span class="s1">&#39;tustates.SC2Replay&#39;</span><span class="p">))</span>
<span class="n">tfly</span> <span class="o">=</span> <span class="n">sc2reader</span><span class="o">.</span><span class="n">load_replay</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">rps_path</span><span class="o">/</span><span class="s1">&#39;terranfly.SC2Replay&#39;</span><span class="p">))</span>

<span class="c1"># I store some basic variables out of the test case replay to make the sample code more</span>
<span class="c1"># readable.</span>
<span class="n">match_events</span> <span class="o">=</span> <span class="p">[</span><span class="n">event</span> <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">single_replay</span><span class="o">.</span><span class="n">events</span><span class="p">]</span>
<span class="n">rpl_duration</span> <span class="o">=</span> <span class="n">single_replay</span><span class="o">.</span><span class="n">length</span><span class="o">.</span><span class="n">seconds</span>
<span class="n">rpl_rec_duration</span> <span class="o">=</span> <span class="n">match_events</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">second</span>
<span class="n">rpl_fps</span> <span class="o">=</span> <span class="n">single_replay</span><span class="o">.</span><span class="n">game_fps</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Builds-orders">Builds-orders<a class="anchor-link" href="#Builds-orders"> </a></h2><p>A crucial part of how players execute a strategy is how they construct their bases and their armies. Currently, in the game, once a match is over, players can review all the order in which the game participants build their first 40 elements. In this module, I use the word element to encompass the game's units, buildings and tech upgrades. These build-orders include buildings (built, upgraded, expanded), units (trained, mutated, warped, merged), and any tech researched.</p>
<p>Since this package is meant to build player profiles based on the players' performance indicators, I need to find a way to capture the overall composition of the players' bases and armies. Moreover, afterwards, I must be able to generalise this composition data to build the players profiles.</p>
<p>Initially, my first instinct was to store the build orders as a time series. I thought of recording a sequence of snapshots, evenly spaced over time, that marked the time and order in which each element entered the game. However, storing the build-orders as a time series is too detailed and is not suited to practical generalisation. So instead, I am opting to extract units, buildings and research compositions at four different game intervals, i.e. whole, early, mid, and late games. These intervals match the measures that I take for macroeconomic indicators in the <code>hand_pstats_events</code> module.</p>
<p>This section explores the factors I need to consider to define a set of functions that users can call to extract the player's elements compositions at the different game intervals and other related indicators.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Listing-a-player's-elements">Listing a player's elements<a class="anchor-link" href="#Listing-a-player's-elements"> </a></h3><p>In any case, the first step to parse any indicators related to the build order is to obtain a list of the player's elements.</p>
<p>In the following code, I use the <code>Player</code> object's <code>units</code> attribute to extract a list of all these elements owned by the player during the match. I also use a list of all the units I want to include in my analysis (i.e. <code>unit_names</code>) to filter unwanted units. For example, I exclude Zerg larvae from my analysis because they are generated automatically by the game with little control from the player. 
{% include note.html content='In this example, I exclude some units that change their play-state during the game (e.g. burrowed units). I exclude these units for the time being to focus on the game&#8217;s basic unit types. Later, I expand on some considerations related to this stage changes that I need to account for in the module&#8217;s <a href="/sc_training/build_parser.html#composition_df"><code>composition_df</code></a> helper function to generate an accurate unit count. ' %}</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># list of zerg players has some particularities that I want to ilustrate straight</span>
<span class="c1"># away. </span>

<span class="n">p2_units</span> <span class="o">=</span> <span class="p">[</span><span class="n">u</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">sing_zerg</span><span class="o">.</span><span class="n">player</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">units</span> <span class="k">if</span> <span class="n">u</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">unit_names</span><span class="p">]</span>
<span class="k">for</span> <span class="n">string</span> <span class="ow">in</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ind</span><span class="o">+</span><span class="mi">1</span><span class="si">:</span><span class="s1">&lt;3</span><span class="si">}</span><span class="s1"> Name: </span><span class="si">{</span><span class="n">u</span><span class="o">.</span><span class="n">name</span><span class="si">:</span><span class="s1">&lt;15</span><span class="si">}</span><span class="s1"> Start: </span><span class="si">{</span><span class="n">u</span><span class="o">.</span><span class="n">started_at</span><span class="si">:</span><span class="s1">&gt;5.0f</span><span class="si">}</span><span class="s1"> End: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">died_at</span><span class="p">)</span><span class="si">:</span><span class="s1">&gt;5</span><span class="si">}</span><span class="s1">&#39;</span> 
                <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">u</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">p2_units</span><span class="p">[:</span><span class="mi">20</span><span class="p">])]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="c1"># This command shows the first 20 units of the player&#39;s units list.</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>1   Name: Lair            Start:     0 End:  None
2   Name: Drone           Start:     0 End:  5184
3   Name: Drone           Start:     0 End:  3530
4   Name: Drone           Start:     0 End:  2046
5   Name: Drone           Start:     0 End:  None
6   Name: Drone           Start:     0 End: 13011
7   Name: Drone           Start:     0 End:  2739
8   Name: Drone           Start:     0 End:  None
9   Name: Drone           Start:     0 End:  None
10  Name: Drone           Start:     0 End:  None
11  Name: Drone           Start:     0 End:  None
12  Name: Drone           Start:     0 End:  2226
13  Name: Drone           Start:     0 End:  4969
14  Name: Overlord        Start:     0 End:  None
15  Name: Overlord        Start:   594 End:  None
16  Name: Drone           Start:   675 End:  None
17  Name: Drone           Start:   678 End:  None
18  Name: Drone           Start:   976 End:  None
19  Name: Drone           Start:   987 End:  None
20  Name: SpawningPool    Start:  1186 End:  None
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>{% include note.html content='each player&#8217;s unit list begins with thirteen or fourteen starting units. For example, if the players play with Protoss or Terran, they start with thirteen units (one main base plus twelve workers). If they play with Zerg, they begin with fourteen units (one main base, twelve workers, and one overlord). Because these elements are not built by the players, they should not count as part of the players&#8217; build strategy.' %}
The following code extracts the unit lists for both players in the sample match, ignoring the starting units. In the examples, I print the first ten items in each list.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">p1_race</span> <span class="o">=</span> <span class="n">sing_zerg</span><span class="o">.</span><span class="n">player</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">play_race</span>
<span class="n">p1_units</span> <span class="o">=</span> <span class="p">[</span><span class="n">u</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">sing_zerg</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">units</span> <span class="k">if</span> <span class="n">u</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">unit_names</span><span class="p">]</span>

<span class="c1"># The following expression stores a comy of the element list excludind</span>
<span class="c1"># the starting elements according to the player&#39;s race</span>
<span class="n">p1_units_no_inits</span> <span class="o">=</span> <span class="n">p1_units</span><span class="p">[(</span><span class="mi">13</span> <span class="k">if</span> <span class="n">p1_race</span> <span class="o">!=</span> <span class="s1">&#39;Zerg&#39;</span> <span class="k">else</span> <span class="mi">14</span><span class="p">):]</span>

<span class="c1"># I print the list of the starting elements in the new list to show they</span>
<span class="c1"># skip the starting elements.</span>
<span class="k">for</span> <span class="n">string</span> <span class="ow">in</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ind</span><span class="o">+</span><span class="mi">1</span><span class="si">:</span><span class="s1">&lt;3</span><span class="si">}</span><span class="s1"> Name: </span><span class="si">{</span><span class="n">u</span><span class="o">.</span><span class="n">name</span><span class="si">:</span><span class="s1">&lt;15</span><span class="si">}</span><span class="s1"> Start: </span><span class="si">{</span><span class="n">u</span><span class="o">.</span><span class="n">started_at</span><span class="si">:</span><span class="s1">&gt;5.0f</span><span class="si">}</span><span class="s1"> End: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">died_at</span><span class="p">)</span><span class="si">:</span><span class="s1">&gt;5</span><span class="si">}</span><span class="s1">&#39;</span> 
                <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">u</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">p1_units_no_inits</span><span class="p">[:</span><span class="mi">10</span><span class="p">])]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>1   Name: SCV             Start:   305 End:  None
2   Name: SCV             Start:   576 End:  None
3   Name: SCV             Start:   847 End:  None
4   Name: SCV             Start:  1239 End:  None
5   Name: Refinery        Start:  1367 End:  None
6   Name: Refinery        Start:  1385 End:  None
7   Name: Barracks        Start:  1416 End:  None
8   Name: SCV             Start:  1580 End:  None
9   Name: SCV             Start:  1851 End:  None
10  Name: SCV             Start:  2122 End:  None
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># This second player is playing with Zerg. Hence, they have more</span>
<span class="c1"># starting units.</span>
<span class="n">p2_race</span> <span class="o">=</span> <span class="n">sing_zerg</span><span class="o">.</span><span class="n">player</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">play_race</span>
<span class="n">p2_units_no_inits</span> <span class="o">=</span> <span class="n">p2_units</span><span class="p">[(</span><span class="mi">13</span> <span class="k">if</span> <span class="n">p2_race</span> <span class="o">!=</span> <span class="s1">&#39;Zerg&#39;</span> <span class="k">else</span> <span class="mi">14</span><span class="p">):]</span>
<span class="k">for</span> <span class="n">string</span> <span class="ow">in</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ind</span><span class="o">+</span><span class="mi">1</span><span class="si">:</span><span class="s1">&lt;3</span><span class="si">}</span><span class="s1"> Name: </span><span class="si">{</span><span class="n">u</span><span class="o">.</span><span class="n">name</span><span class="si">:</span><span class="s1">&lt;15</span><span class="si">}</span><span class="s1"> Start: </span><span class="si">{</span><span class="n">u</span><span class="o">.</span><span class="n">started_at</span><span class="si">:</span><span class="s1">&gt;5.0f</span><span class="si">}</span><span class="s1"> End: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">died_at</span><span class="p">)</span><span class="si">:</span><span class="s1">&gt;5</span><span class="si">}</span><span class="s1">&#39;</span> 
                <span class="k">for</span> <span class="n">ind</span><span class="p">,</span> <span class="n">u</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">p2_units_no_inits</span><span class="p">[:</span><span class="mi">10</span><span class="p">])]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>1   Name: Overlord        Start:   594 End:  None
2   Name: Drone           Start:   675 End:  None
3   Name: Drone           Start:   678 End:  None
4   Name: Drone           Start:   976 End:  None
5   Name: Drone           Start:   987 End:  None
6   Name: SpawningPool    Start:  1186 End:  None
7   Name: Drone           Start:  1223 End:  None
8   Name: Extractor       Start:  1566 End:  None
9   Name: Drone           Start:  1675 End:  None
10  Name: Drone           Start:  1878 End:  None
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Alternative-Implementation-with-Unit-Tracker-Events">Alternative Implementation with Unit Tracker Events<a class="anchor-link" href="#Alternative-Implementation-with-Unit-Tracker-Events"> </a></h3><p>A different way to generate this lists is to use the <code>Replay</code>'s <code>UnitBornEvent</code>, <code>UnitInitEvent</code>, <code>UnitDoneEvent</code> and <code>UnitTypeChangeEvent</code> instances. This second approach offers me access to the unit's spawning time through the event's <code>second</code> attribute. However, this approach means having to consolidate four discrete lists with overlapping data.</p>
<p>In the code below, I collect the events that store information on the second player's unit-spawning. I split this information into four lists, storing data on the different tracker events, i.e. units born, initialised, done, and changed. Examining these lists closely, one can see that they are different; note their lengths.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">p1_uborn_e</span> <span class="o">=</span> <span class="p">[</span><span class="n">event</span> <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">match_events</span> 
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">sc2reader</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">UnitBornEvent</span><span class="p">)</span> 
            <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">control_pid</span> <span class="o">==</span> <span class="mi">1</span>
            <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">unit_names</span><span class="p">]</span>
<span class="n">p1_uinit_e</span> <span class="o">=</span> <span class="p">[</span><span class="n">event</span> <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">match_events</span> 
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">sc2reader</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">UnitInitEvent</span><span class="p">)</span> 
            <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">control_pid</span> <span class="o">==</span> <span class="mi">1</span>
            <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">unit_names</span><span class="p">]</span>
<span class="n">p1_udone_e</span> <span class="o">=</span> <span class="p">[</span><span class="n">event</span> <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">match_events</span> 
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">sc2reader</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">UnitDoneEvent</span><span class="p">)</span> 
            <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">owner</span><span class="o">.</span><span class="n">pid</span> <span class="o">==</span> <span class="mi">1</span>
            <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">unit_names</span><span class="p">]</span>
<span class="n">p1_uchange_e</span> <span class="o">=</span> <span class="p">[</span><span class="n">event</span> <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">match_events</span> 
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">sc2reader</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">UnitTypeChangeEvent</span><span class="p">)</span> 
            <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">owner</span><span class="o">.</span><span class="n">pid</span> <span class="o">==</span> <span class="mi">1</span>
            <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">unit_names</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;UnitsBorn: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">p1_uborn_e</span><span class="p">)</span><span class="si">}</span><span class="s1"> Init: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">p1_uinit_e</span><span class="p">)</span><span class="si">}</span><span class="s1"> Done: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">p1_udone_e</span><span class="p">)</span><span class="si">}</span><span class="s1"> Change: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">p1_uchange_e</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>UnitsBorn: 54 Init: 35 Done: 34 Change: 2
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Meanwhile, looking at the intersections between the lists, I can see much overlap between them. See the code below.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">u_init_done_intersection</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">e</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">p1_udone_e</span><span class="p">])</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">([</span><span class="n">e</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">p1_uinit_e</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">u_init_done_intersection</span><span class="p">)</span><span class="si">}</span><span class="s1"> where initialised and done. One was destructed before completion.&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>34 where initialised and done. One was destructed before completion.
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">u_born_change_intersection</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">e</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">p1_uborn_e</span><span class="p">])</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">([</span><span class="n">e</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">p1_uchange_e</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">u_born_change_intersection</span><span class="p">)</span><span class="si">}</span><span class="s1"> changed during the game, possibly to another unti type.&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>0 changed during the game, possibly to another unti type.
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">u_init_change_intersection</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">e</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">p1_uinit_e</span><span class="p">])</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">([</span><span class="n">e</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">p1_uchange_e</span><span class="p">])</span>
<span class="n">u_done_change_intersection</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">e</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">p1_udone_e</span><span class="p">])</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">([</span><span class="n">e</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">p1_uchange_e</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">u_init_change_intersection</span><span class="p">)</span><span class="si">}</span><span class="s1"> initialised and change, </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">u_done_change_intersection</span><span class="p">)</span><span class="si">}</span><span class="s1"> complete their building and changed&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>2 initialised and change, 2 complete their building and changed
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This overlap means that, while building a player's unit list from these events may be possible, it may be impractical compared to the first possibility. Still, I can learn how to extract the times for each unit's life stages (building initiation and completion, state change or death) during the match from the information contained in these events.</p>
<p>For instance, take the case of <code>UnitBornEvents</code>. The frame where these events are executed is equal to the start (building initiation) and finished (building completion) frames recorded by the units linked to them.</p>
<p>Additionally, this data shows that the quotient of the units recorded birth frame (i.e. its <code>finished_at</code> attribute) and the replay's registered frames-per-second (i.e. <code>Replay.game_fps</code>) is equal to the UnitBornEvent's recorded execution time in seconds. I can convert this time into the real-time index using the <a href="/sc_training/handle_tracker_events.html#calc_realtime_index"><code>calc_realtime_index</code></a> function extracted from the <code>handle_tracker_event</code> module.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;UnitName: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">name</span><span class="si">:</span><span class="s1">&lt;13</span><span class="si">}</span><span class="s1"> Event_rec_sec: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">second</span><span class="si">:</span><span class="s1">&gt;6.0f</span><span class="si">}</span><span class="s1">  Event_rec_frame: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">frame</span><span class="si">:</span><span class="s1">&gt;6.0f</span><span class="si">}</span><span class="s1">  U_rec_start_frame: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">started_at</span><span class="si">:</span><span class="s1">&gt;6.0f</span><span class="si">}</span><span class="s1"> U_rec_finish_frame: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">finished_at</span><span class="si">:</span><span class="s1">&gt;6.0f</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">p1_uborn_e</span><span class="p">][</span><span class="mi">14</span><span class="p">:</span><span class="mi">20</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;UnitName: Probe         Event_rec_sec:     69  Event_rec_frame:   1110  U_rec_start_frame:   1110 U_rec_finish_frame:   1110&#39;,
 &#39;UnitName: Probe         Event_rec_sec:    133  Event_rec_frame:   2143  U_rec_start_frame:   2143 U_rec_finish_frame:   2143&#39;,
 &#39;UnitName: Probe         Event_rec_sec:    156  Event_rec_frame:   2496  U_rec_start_frame:   2496 U_rec_finish_frame:   2496&#39;,
 &#39;UnitName: Probe         Event_rec_sec:    172  Event_rec_frame:   2767  U_rec_start_frame:   2767 U_rec_finish_frame:   2767&#39;,
 &#39;UnitName: Probe         Event_rec_sec:    199  Event_rec_frame:   3194  U_rec_start_frame:   3194 U_rec_finish_frame:   3194&#39;,
 &#39;UnitName: Probe         Event_rec_sec:    216  Event_rec_frame:   3465  U_rec_start_frame:   3465 U_rec_finish_frame:   3465&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Similarly, the <code>UnitInitEvent</code>'s recoded execution frame is the same as the unit's recorded <code>started_at</code> frame.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;UName: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">name</span><span class="si">:</span><span class="s1">&lt;15</span><span class="si">}</span><span class="s1"> Event_rec_sec: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">second</span><span class="p">)</span><span class="si">:</span><span class="s1">&gt;6</span><span class="si">}</span><span class="s1">  Event_rec_frame: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">frame</span><span class="p">)</span><span class="si">:</span><span class="s1">&gt;6</span><span class="si">}</span><span class="s1">  U_rec_start_frame: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">started_at</span><span class="p">)</span><span class="si">:</span><span class="s1">&gt;6</span><span class="si">}</span><span class="s1"> U_rec_finish_frame: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">finished_at</span><span class="p">)</span><span class="si">:</span><span class="s1">&gt;6</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">p1_uinit_e</span><span class="p">][</span><span class="o">-</span><span class="mi">10</span><span class="p">:]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;UName: Pylon           Event_rec_sec:    662  Event_rec_frame:  10604  U_rec_start_frame:  10604 U_rec_finish_frame:  11004&#39;,
 &#39;UName: Nexus           Event_rec_sec:    682  Event_rec_frame:  10921  U_rec_start_frame:  10921 U_rec_finish_frame:  12521&#39;,
 &#39;UName: PhotonCannon    Event_rec_sec:    693  Event_rec_frame:  11090  U_rec_start_frame:  11090 U_rec_finish_frame:  11730&#39;,
 &#39;UName: PhotonCannon    Event_rec_sec:    702  Event_rec_frame:  11243  U_rec_start_frame:  11243 U_rec_finish_frame:   None&#39;,
 &#39;UName: Zealot          Event_rec_sec:    705  Event_rec_frame:  11284  U_rec_start_frame:  11284 U_rec_finish_frame:  11540&#39;,
 &#39;UName: Zealot          Event_rec_sec:    706  Event_rec_frame:  11297  U_rec_start_frame:  11297 U_rec_finish_frame:  11553&#39;,
 &#39;UName: Stalker         Event_rec_sec:    755  Event_rec_frame:  12085  U_rec_start_frame:  12085 U_rec_finish_frame:  12166&#39;,
 &#39;UName: Stalker         Event_rec_sec:    755  Event_rec_frame:  12094  U_rec_start_frame:  12094 U_rec_finish_frame:  12175&#39;,
 &#39;UName: Stalker         Event_rec_sec:    803  Event_rec_frame:  12863  U_rec_start_frame:  12863 U_rec_finish_frame:  12944&#39;,
 &#39;UName: Stalker         Event_rec_sec:    804  Event_rec_frame:  12873  U_rec_start_frame:  12873 U_rec_finish_frame:  12954&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Meanwhile, in the case of the <code>UnitDoneEvents</code>, the event's recoded execution frame is the same as the unit's recorded <code>finish_at</code> frame.
{% include note.html content='if a unit is killed before it finishes construction, it will not generate an <code>UnitDoneEvent</code>. Nevertheless, it still appears as part of the player&#8217;s units list. Look at the last unit in the previous list. It is absent from the next.' %}</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;UName: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">name</span><span class="si">:</span><span class="s1">&lt;15</span><span class="si">}</span><span class="s1"> Event_rec_sec: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">second</span><span class="si">:</span><span class="s1">&gt;6.0f</span><span class="si">}</span><span class="s1">  Event_rec_frame: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">frame</span><span class="si">:</span><span class="s1">&gt;6.0f</span><span class="si">}</span><span class="s1">  U_rec_start_frame: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">started_at</span><span class="si">:</span><span class="s1">&gt;6.0f</span><span class="si">}</span><span class="s1"> U_rec_finish_frame: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">finished_at</span><span class="si">:</span><span class="s1">&gt;6.0f</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">p1_udone_e</span><span class="p">][</span><span class="o">-</span><span class="mi">10</span><span class="p">:]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;UName: Pylon           Event_rec_sec:    676  Event_rec_frame:  10828  U_rec_start_frame:  10428 U_rec_finish_frame:  10828&#39;,
 &#39;UName: Pylon           Event_rec_sec:    687  Event_rec_frame:  11004  U_rec_start_frame:  10604 U_rec_finish_frame:  11004&#39;,
 &#39;UName: Zealot          Event_rec_sec:    721  Event_rec_frame:  11540  U_rec_start_frame:  11284 U_rec_finish_frame:  11540&#39;,
 &#39;UName: Zealot          Event_rec_sec:    722  Event_rec_frame:  11553  U_rec_start_frame:  11297 U_rec_finish_frame:  11553&#39;,
 &#39;UName: PhotonCannon    Event_rec_sec:    733  Event_rec_frame:  11730  U_rec_start_frame:  11090 U_rec_finish_frame:  11730&#39;,
 &#39;UName: Stalker         Event_rec_sec:    760  Event_rec_frame:  12166  U_rec_start_frame:  12085 U_rec_finish_frame:  12166&#39;,
 &#39;UName: Stalker         Event_rec_sec:    760  Event_rec_frame:  12175  U_rec_start_frame:  12094 U_rec_finish_frame:  12175&#39;,
 &#39;UName: Nexus           Event_rec_sec:    782  Event_rec_frame:  12521  U_rec_start_frame:  10921 U_rec_finish_frame:  12521&#39;,
 &#39;UName: Stalker         Event_rec_sec:    809  Event_rec_frame:  12944  U_rec_start_frame:  12863 U_rec_finish_frame:  12944&#39;,
 &#39;UName: Stalker         Event_rec_sec:    809  Event_rec_frame:  12954  U_rec_start_frame:  12873 U_rec_finish_frame:  12954&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The following code uses data from another match to show the links between <code>UnitInitEvent</code>, <code>UnitDoneEvent</code> and a player's units list.</p>
<p>The first segment shows that three units get started but are never completed.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">uinit_e</span> <span class="o">=</span> <span class="p">[</span><span class="n">event</span> <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">single_replay</span><span class="o">.</span><span class="n">events</span> 
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">sc2reader</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">UnitInitEvent</span><span class="p">)</span> 
            <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">control_pid</span> <span class="o">==</span> <span class="mi">2</span>
            <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">unit_names</span><span class="p">]</span>
<span class="n">udone_e</span> <span class="o">=</span> <span class="p">[</span><span class="n">event</span> <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">single_replay</span><span class="o">.</span><span class="n">events</span> 
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">sc2reader</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">UnitDoneEvent</span><span class="p">)</span> 
            <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">owner</span><span class="o">.</span><span class="n">pid</span> <span class="o">==</span> <span class="mi">2</span>
            <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">unit_names</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;UnitsInit: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">uinit_e</span><span class="p">)</span><span class="si">}</span><span class="s1"> UnitsDone: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">udone_e</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>UnitsInit: 24 UnitsDone: 21
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The second segment shows that these units can be identified in the player's units-list by the difference between the <code>started_at</code> and <code>finished_at</code> values.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">incomplete_u</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;UNane: </span><span class="si">{</span><span class="n">u</span><span class="o">.</span><span class="n">name</span><span class="si">:</span><span class="s1">&lt;18</span><span class="si">}</span><span class="s1"> unitId: </span><span class="si">{</span><span class="n">u</span><span class="o">.</span><span class="n">id</span><span class="si">:</span><span class="s1">&lt;10.0f</span><span class="si">}</span><span class="s1"> u_start_frame: </span><span class="si">{</span><span class="n">u</span><span class="o">.</span><span class="n">started_at</span><span class="si">:</span><span class="s1">&gt;8.0f</span><span class="si">}</span><span class="s1"> u_finish_frame: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">finished_at</span><span class="p">)</span><span class="si">:</span><span class="s1">&gt;8</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">single_replay</span><span class="o">.</span><span class="n">players</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">units</span> 
        <span class="k">if</span> <span class="n">u</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">unit_names</span>
        <span class="ow">and</span> <span class="n">u</span><span class="o">.</span><span class="n">finished_at</span> <span class="o">==</span> <span class="kc">None</span><span class="p">]</span>
<span class="n">incomplete_u</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;UNane: CommandCenter      unitId: 94109700   u_start_frame:    13111 u_finish_frame:     None&#39;,
 &#39;UNane: Refinery           unitId: 92012546   u_start_frame:    13175 u_finish_frame:     None&#39;,
 &#39;UNane: Refinery           unitId: 94633985   u_start_frame:    13213 u_finish_frame:     None&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Interestingly, the <code>UnitDiedEvent</code> list only includes these incomplete units' destruction if they are killed by another player, as shown by the following code.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">p1_incomplet_units_ids</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">u</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">u</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">, his unit was killed by player </span><span class="si">{</span><span class="n">u</span><span class="o">.</span><span class="n">killed_by</span><span class="o">.</span><span class="n">pid</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">single_replay</span><span class="o">.</span><span class="n">player</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">units</span> 
        <span class="k">if</span> <span class="n">u</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">unit_names</span>
        <span class="ow">and</span> <span class="n">u</span><span class="o">.</span><span class="n">finished_at</span> <span class="o">==</span> <span class="kc">None</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;List of incomplete units on player 1</span><span class="se">\&#39;</span><span class="s1">s units-list </span><span class="si">{</span><span class="n">p1_incomplet_units_ids</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>


<span class="n">p1_udied_e</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">single_replay</span><span class="o">.</span><span class="n">events</span> 
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">sc2reader</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">UnitDiedEvent</span><span class="p">)</span>
            <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">owner</span> <span class="o">!=</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">owner</span><span class="o">.</span><span class="n">pid</span> <span class="o">==</span> <span class="mi">1</span>
            <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">unit_names</span>
            <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">finished_at</span> <span class="o">==</span> <span class="kc">None</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;List of units in UnitDiedEvent for player 1 </span><span class="si">{</span><span class="n">p1_udied_e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;------------------------------------------------&#39;</span><span class="p">)</span>
<span class="n">p2_incomplet_units_ids</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">u</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">u</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">single_replay</span><span class="o">.</span><span class="n">player</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">units</span> 
        <span class="k">if</span> <span class="n">u</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">unit_names</span>
        <span class="ow">and</span> <span class="n">u</span><span class="o">.</span><span class="n">finished_at</span> <span class="o">==</span> <span class="kc">None</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;List of incomplete units on player 2</span><span class="se">\&#39;</span><span class="s1">s units-list </span><span class="si">{</span><span class="n">p2_incomplet_units_ids</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>


<span class="n">p2_udied_e</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">single_replay</span><span class="o">.</span><span class="n">events</span> 
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">sc2reader</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">tracker</span><span class="o">.</span><span class="n">UnitDiedEvent</span><span class="p">)</span>
            <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">owner</span> <span class="o">!=</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">owner</span><span class="o">.</span><span class="n">pid</span> <span class="o">==</span> <span class="mi">2</span>
            <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">unit_names</span>
            <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">finished_at</span> <span class="o">==</span> <span class="kc">None</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;List of units in UnitDiedEvent for player 2 </span><span class="si">{</span><span class="n">p2_udied_e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>List of incomplete units on player 1&#39;s units-list [&#39;PhotonCannon, 78118917, his unit was killed by player 2&#39;]
List of units in UnitDiedEvent for player 1 [&#39;PhotonCannon, 78118917&#39;]
------------------------------------------------
List of incomplete units on player 2&#39;s units-list [&#39;CommandCenter, 94109700&#39;, &#39;Refinery, 92012546&#39;, &#39;Refinery, 94633985&#39;]
List of units in UnitDiedEvent for player 2 []
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In the case above case, units player 2's incomplete units do not generate <code>UnitDiedEvent</code>s becaused they were cancelled, not killed. This is the reason why player 2's <code>UnitDiedEvent</code> list is empty.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Counting-Units-With-Multiple-States">Counting Units With Multiple States<a class="anchor-link" href="#Counting-Units-With-Multiple-States"> </a></h3><p>In the examples above, I have only counted units that remain in their primary state throughout the match for simplicity. However, in most games, some units will change states. I must consider this factor because of how sc2reader keeps track of the units.</p>
<p>For example, suppose I extract a list of all Zerg units' names in a match. In that case, I may notice that some <em>Infestor</em> units are counted as such, but others are counted as <em>InfestorBurrowed</em>.</p>
<p>Meanwhile, a similar operation around a Terran player's units shows units such as a <em>SiegeTank</em> have secondary stages like <em>SiegeTankSieged</em>. Similarly, a <em>Hellion</em> can also appear as a <em>BattleHellion</em> and a <em>WidowMine</em> as a <em>WidowMineBurrowed</em>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">zerg_player_units</span> <span class="o">=</span> <span class="p">[</span><span class="n">u</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">zustates</span><span class="o">.</span><span class="n">player</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">units</span>
                    <span class="k">if</span> <span class="n">u</span><span class="o">.</span><span class="n">is_army</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Sample Zerg unit set in zustates replay.&#39;</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">zerg_player_units</span><span class="p">))</span>

<span class="c1"># Print set of terran units in a match</span>
<span class="n">terran_player_units</span> <span class="o">=</span> <span class="p">[</span><span class="n">u</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">tustates</span><span class="o">.</span><span class="n">player</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">units</span>
                    <span class="k">if</span> <span class="n">u</span><span class="o">.</span><span class="n">is_army</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Sample Terran unit set in tustates replay.&#39;</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">terran_player_units</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Sample Zerg unit set in zustates replay.
{&#39;Baneling&#39;,
 &#39;Hydralisk&#39;,
 &#39;Infestor&#39;,
 &#39;InfestorBurrowed&#39;,
 &#39;Lurker&#39;,
 &#39;Overlord&#39;,
 &#39;Overseer&#39;,
 &#39;Queen&#39;,
 &#39;Ravager&#39;,
 &#39;Roach&#39;,
 &#39;Zergling&#39;}

Sample Terran unit set in tustates replay.
{&#39;BattleHellion&#39;,
 &#39;Hellion&#39;,
 &#39;Marauder&#39;,
 &#39;Marine&#39;,
 &#39;Medivac&#39;,
 &#39;SiegeTank&#39;,
 &#39;SiegeTankSieged&#39;,
 &#39;Thor&#39;,
 &#39;WidowMine&#39;,
 &#39;WidowMineBurrowed&#39;}
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>However, an army composition should count these units in different stages as the same. Thus I need to account for how <strong>sc2reader</strong> stores the unit according to the state in which they finished or exited the game. In the following code, I use a unit types list and several conditions to demonstrate how one can filter the initial list. I also build a DataFrame with a Unit column that records the same name for units of the same type in multiple states to normalise the unit classification.</p>
<p>Note that, if I count the units based on the type recorded by <strong>sc2reader</strong>, the count includes the different unit states. Meanwhile, the normalised count adds the units of the same type that are in different states.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">terran_player_units</span> <span class="o">=</span> <span class="p">[(</span><span class="n">uname</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">tustates</span><span class="o">.</span><span class="n">player</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">units</span> <span class="k">for</span> <span class="n">uname</span> <span class="ow">in</span> <span class="n">race_armies</span><span class="p">[</span><span class="s1">&#39;Terran&#39;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">uname</span> <span class="ow">in</span> <span class="n">u</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="c1"># Use the naming convention to get all units in different states</span>
                    <span class="ow">and</span> <span class="n">u</span><span class="o">.</span><span class="n">is_army</span> <span class="o">==</span> <span class="kc">True</span><span class="p">]</span>
<span class="n">tpunits_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s1">&#39;Unit&#39;</span><span class="p">:[</span><span class="n">uname</span> <span class="k">for</span> <span class="n">uname</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">terran_player_units</span><span class="p">],</span>
        <span class="s1">&#39;Uname&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">u</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">uname</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">terran_player_units</span><span class="p">],</span>
        <span class="s1">&#39;UnitID&#39;</span><span class="p">:[</span><span class="nb">id</span> <span class="k">for</span> <span class="n">uname</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">terran_player_units</span><span class="p">]})</span>

<span class="c1"># print(tpunits_df.groupby(&#39;Uname&#39;).size().to_markdown())</span>
<span class="c1"># print(tpunits_df.groupby(&#39;Unit&#39;).size().to_markdown())</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This table shows the count based on <strong>sc2reader</strong> type register.</p>
<table>
<thead><tr>
<th style="text-align:left">Uname</th>
<th style="text-align:right"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">BattleHellion</td>
<td style="text-align:right">10</td>
</tr>
<tr>
<td style="text-align:left">Hellion</td>
<td style="text-align:right">6</td>
</tr>
<tr>
<td style="text-align:left">Marauder</td>
<td style="text-align:right">10</td>
</tr>
<tr>
<td style="text-align:left">Marine</td>
<td style="text-align:right">15</td>
</tr>
<tr>
<td style="text-align:left">Medivac</td>
<td style="text-align:right">3</td>
</tr>
<tr>
<td style="text-align:left">SiegeTank</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:left">SiegeTankSieged</td>
<td style="text-align:right">2</td>
</tr>
<tr>
<td style="text-align:left">Thor</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:left">WidowMine</td>
<td style="text-align:right">5</td>
</tr>
<tr>
<td style="text-align:left">WidowMineBurrowed</td>
<td style="text-align:right">7</td>
</tr>
</tbody>
</table>
<p>This table shows the count based on the normalised names.</p>
<table>
<thead><tr>
<th style="text-align:left">Unit</th>
<th style="text-align:right"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">hellion</td>
<td style="text-align:right">16</td>
</tr>
<tr>
<td style="text-align:left">marauder</td>
<td style="text-align:right">10</td>
</tr>
<tr>
<td style="text-align:left">marine</td>
<td style="text-align:right">15</td>
</tr>
<tr>
<td style="text-align:left">medivac</td>
<td style="text-align:right">3</td>
</tr>
<tr>
<td style="text-align:left">siegetank</td>
<td style="text-align:right">3</td>
</tr>
<tr>
<td style="text-align:left">thor</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:left">widowmine</td>
<td style="text-align:right">12</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This same rule applies to buildings. However, in this case, there are two caveats when counting Terran buildings. First, <em>TechLab</em> and <em>Reactor</em> instances do not follow the same <em>Unit/State</em> naming convention as the other multi-state units. Instead, they follow the inverse pattern, <em>State/Unit</em>. Second, both <em>TechLab</em> and <em>Reactor</em> generate a double count. Firstly, they appear as themselves, and, secondly, they re-register the production buildings they expand (i.e. barracks, starports, and factories). In this case, they re-register these production buildings with the same hash-id that identifies them. Thus, when counting Terran buildings, I must re-filter the DataFrame to account for these anomalies. The following code illustrates this issue.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">terran_player_buildings</span> <span class="o">=</span> <span class="p">[(</span><span class="n">uname</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">tustates</span><span class="o">.</span><span class="n">player</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">units</span> <span class="k">for</span> <span class="n">uname</span> <span class="ow">in</span> <span class="n">race_buildings</span><span class="p">[</span><span class="s1">&#39;Terran&#39;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">uname</span> <span class="ow">in</span> <span class="n">u</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="c1"># Use the naming convention to get all units in different states</span>
                    <span class="ow">and</span> <span class="n">u</span><span class="o">.</span><span class="n">is_building</span> <span class="o">==</span> <span class="kc">True</span><span class="p">]</span>
<span class="n">tbunits_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s1">&#39;Unit&#39;</span><span class="p">:[</span><span class="n">uname</span> <span class="k">for</span> <span class="n">uname</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">terran_player_buildings</span><span class="p">],</span>
        <span class="s1">&#39;Uname&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">u</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">uname</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">terran_player_buildings</span><span class="p">],</span>
        <span class="s1">&#39;UnitID&#39;</span><span class="p">:[</span><span class="nb">id</span> <span class="k">for</span> <span class="n">uname</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">terran_player_buildings</span><span class="p">]})</span>

<span class="c1"># print(tbunits_df[9:25].to_markdown())</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>{% include note.html content='see the rows 9, 10, 14, 15, 20 and 21 of the table that results from the code above.' %}</p>
<table>
<thead><tr>
<th style="text-align:right"></th>
<th style="text-align:left">Unit</th>
<th style="text-align:left">Uname</th>
<th style="text-align:right">UnitID</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">9</td>
<td style="text-align:left">barracks</td>
<td style="text-align:left">BarracksTechLab</td>
<td style="text-align:right">67895297</td>
</tr>
<tr>
<td style="text-align:right">10</td>
<td style="text-align:left">techlab</td>
<td style="text-align:left">BarracksTechLab</td>
<td style="text-align:right">67895297</td>
</tr>
<tr>
<td style="text-align:right">11</td>
<td style="text-align:left">factory</td>
<td style="text-align:left">Factory</td>
<td style="text-align:right">68681729</td>
</tr>
<tr>
<td style="text-align:right">12</td>
<td style="text-align:left">supplydepot</td>
<td style="text-align:left">SupplyDepot</td>
<td style="text-align:right">71041026</td>
</tr>
<tr>
<td style="text-align:right">13</td>
<td style="text-align:left">supplydepot</td>
<td style="text-align:left">SupplyDepot</td>
<td style="text-align:right">74186754</td>
</tr>
<tr>
<td style="text-align:right">14</td>
<td style="text-align:left">factory</td>
<td style="text-align:left">FactoryTechLab</td>
<td style="text-align:right">74711042</td>
</tr>
<tr>
<td style="text-align:right">15</td>
<td style="text-align:left">techlab</td>
<td style="text-align:left">FactoryTechLab</td>
<td style="text-align:right">74711042</td>
</tr>
<tr>
<td style="text-align:right">16</td>
<td style="text-align:left">sensortower</td>
<td style="text-align:left">SensorTower</td>
<td style="text-align:right">76021761</td>
</tr>
<tr>
<td style="text-align:right">17</td>
<td style="text-align:left">refinery</td>
<td style="text-align:left">Refinery</td>
<td style="text-align:right">76546050</td>
</tr>
<tr>
<td style="text-align:right">18</td>
<td style="text-align:left">factory</td>
<td style="text-align:left">Factory</td>
<td style="text-align:right">77856769</td>
</tr>
<tr>
<td style="text-align:right">19</td>
<td style="text-align:left">refinery</td>
<td style="text-align:left">Refinery</td>
<td style="text-align:right">78381057</td>
</tr>
<tr>
<td style="text-align:right">20</td>
<td style="text-align:left">supplydepot</td>
<td style="text-align:left">SupplyDepot</td>
<td style="text-align:right">83099649</td>
</tr>
<tr>
<td style="text-align:right">21</td>
<td style="text-align:left">factory</td>
<td style="text-align:left">FactoryReactor</td>
<td style="text-align:right">83361793</td>
</tr>
<tr>
<td style="text-align:right">22</td>
<td style="text-align:left">reactor</td>
<td style="text-align:left">FactoryReactor</td>
<td style="text-align:right">83361793</td>
</tr>
<tr>
<td style="text-align:right">23</td>
<td style="text-align:left">armory</td>
<td style="text-align:left">Armory</td>
<td style="text-align:right">83623937</td>
</tr>
<tr>
<td style="text-align:right">24</td>
<td style="text-align:left">supplydepot</td>
<td style="text-align:left">SupplyDepot</td>
<td style="text-align:right">83886081</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tbunits_df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="s1">&#39;UnitID&#39;</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="s1">&#39;last&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 

<span class="c1"># Correct misslabeling of reactors     </span>
<span class="n">tbunits_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">tbunits_df</span><span class="p">[</span><span class="s1">&#39;Uname&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;Reactor&#39;</span><span class="p">),</span> <span class="s1">&#39;Unit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;reactor&#39;</span>
<span class="n">tbunits_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">tbunits_df</span><span class="p">[</span><span class="s1">&#39;Uname&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;TechLab&#39;</span><span class="p">),</span> <span class="s1">&#39;Unit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;techlab&#39;</span>
<span class="c1"># print(tbunits_df[8:25].to_markdown())</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>{% include note.html content='in the following table the duplicates in lines 9, 14 and 21 have been filtered.' %}</p>
<table>
<thead><tr>
<th style="text-align:right"></th>
<th style="text-align:left">Unit</th>
<th style="text-align:left">Uname</th>
<th style="text-align:right">UnitID</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">8</td>
<td style="text-align:left">planetaryfortress</td>
<td style="text-align:left">PlanetaryFortress</td>
<td style="text-align:right">64749570</td>
</tr>
<tr>
<td style="text-align:right">10</td>
<td style="text-align:left">techlab</td>
<td style="text-align:left">BarracksTechLab</td>
<td style="text-align:right">67895297</td>
</tr>
<tr>
<td style="text-align:right">11</td>
<td style="text-align:left">factory</td>
<td style="text-align:left">Factory</td>
<td style="text-align:right">68681729</td>
</tr>
<tr>
<td style="text-align:right">12</td>
<td style="text-align:left">supplydepot</td>
<td style="text-align:left">SupplyDepot</td>
<td style="text-align:right">71041026</td>
</tr>
<tr>
<td style="text-align:right">13</td>
<td style="text-align:left">supplydepot</td>
<td style="text-align:left">SupplyDepot</td>
<td style="text-align:right">74186754</td>
</tr>
<tr>
<td style="text-align:right">15</td>
<td style="text-align:left">techlab</td>
<td style="text-align:left">FactoryTechLab</td>
<td style="text-align:right">74711042</td>
</tr>
<tr>
<td style="text-align:right">16</td>
<td style="text-align:left">sensortower</td>
<td style="text-align:left">SensorTower</td>
<td style="text-align:right">76021761</td>
</tr>
<tr>
<td style="text-align:right">17</td>
<td style="text-align:left">refinery</td>
<td style="text-align:left">Refinery</td>
<td style="text-align:right">76546050</td>
</tr>
<tr>
<td style="text-align:right">18</td>
<td style="text-align:left">factory</td>
<td style="text-align:left">Factory</td>
<td style="text-align:right">77856769</td>
</tr>
<tr>
<td style="text-align:right">19</td>
<td style="text-align:left">refinery</td>
<td style="text-align:left">Refinery</td>
<td style="text-align:right">78381057</td>
</tr>
<tr>
<td style="text-align:right">20</td>
<td style="text-align:left">supplydepot</td>
<td style="text-align:left">SupplyDepot</td>
<td style="text-align:right">83099649</td>
</tr>
<tr>
<td style="text-align:right">22</td>
<td style="text-align:left">reactor</td>
<td style="text-align:left">FactoryReactor</td>
<td style="text-align:right">83361793</td>
</tr>
<tr>
<td style="text-align:right">23</td>
<td style="text-align:left">armory</td>
<td style="text-align:left">Armory</td>
<td style="text-align:right">83623937</td>
</tr>
<tr>
<td style="text-align:right">24</td>
<td style="text-align:left">supplydepot</td>
<td style="text-align:left">SupplyDepot</td>
<td style="text-align:right">83886081</td>
</tr>
<tr>
<td style="text-align:right">25</td>
<td style="text-align:left">planetaryfortress</td>
<td style="text-align:left">PlanetaryFortress</td>
<td style="text-align:right">84672513</td>
</tr>
<tr>
<td style="text-align:right">26</td>
<td style="text-align:left">supplydepot</td>
<td style="text-align:left">SupplyDepot</td>
<td style="text-align:right">29097986</td>
</tr>
<tr>
<td style="text-align:right">27</td>
<td style="text-align:left">supplydepot</td>
<td style="text-align:left">SupplyDepot</td>
<td style="text-align:right">86507521</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Functions">Functions<a class="anchor-link" href="#Functions"> </a></h2><p>In this section, I develop the functions this module exports. These functions allow for the extraction of various performance indicators relative to the units trained, buildings built and upgrades researched by players through a match.</p>
<p>As is the case for other modules in this package, the exportable functions use several helper functions that can be consulted in the module's development notebooks or the module's source code. However, these helper functions are not included in this documentation.</p>
<h3 id="Composition-functions">Composition functions<a class="anchor-link" href="#Composition-functions"> </a></h3><p>The following functions generate lists of dictionaries that describe a player's army or buildings composition (<a href="/sc_training/build_parser.html#count_composicion"><code>count_composicion</code></a>) and the number of units that started training or buildings that started construction (<a href="/sc_training/build_parser.html#count_started"><code>count_started</code></a>) during the whole match and through the early, mid and late games.
 In this case, I define <em>composition</em> as the number of active units of different types a player has in the game. This count goes up every time a unit is created and down if they are killed. Meanwhile, <em>count_started</em> refers to the player's intended army, i.e. the number of units of different types they try to create at each interval of the game.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The two functions extract their information from a <code>pandas.DataFrame</code> generated by the helper function <a href="/sc_training/build_parser.html#composition_df"><code>composition_df</code></a>. This DataFrame includes each unit's type, the time they entered the game and their time of death. I illustrate this DataFrame's composition with a portion of the players' units during a sample match in the following table.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The following table shows a the tail of a sample DataFrame generated by calling <a href="/sc_training/build_parser.html#composition_df"><code>composition_df</code></a> helper function on the <code>tfly</code> replay.</p>
<table>
<thead><tr>
<th style="text-align:right"></th>
<th style="text-align:left">Unit</th>
<th style="text-align:right">started_building</th>
<th style="text-align:right">enter_game_time</th>
<th style="text-align:left">died_time</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">44</td>
<td style="text-align:left">marine</td>
<td style="text-align:right">745.87</td>
<td style="text-align:right">745.87</td>
<td style="text-align:left">NaT</td>
</tr>
<tr>
<td style="text-align:right">45</td>
<td style="text-align:left">autoturret</td>
<td style="text-align:right">748.883</td>
<td style="text-align:right">748.883</td>
<td style="text-align:left">759.0440051020407</td>
</tr>
<tr>
<td style="text-align:right">46</td>
<td style="text-align:left">marine</td>
<td style="text-align:right">763.585</td>
<td style="text-align:right">763.585</td>
<td style="text-align:left">NaT</td>
</tr>
<tr>
<td style="text-align:right">47</td>
<td style="text-align:left">marine</td>
<td style="text-align:right">763.81</td>
<td style="text-align:right">763.81</td>
<td style="text-align:left">NaT</td>
</tr>
<tr>
<td style="text-align:right">48</td>
<td style="text-align:left">autoturret</td>
<td style="text-align:right">783.998</td>
<td style="text-align:right">783.998</td>
<td style="text-align:left">794.2940051020408</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Similarly, the functions use the helper <a href="/sc_training/build_parser.html#count_active_units"><code>count_active_units</code></a> function in conjunction with the <a href="/sc_training/build_parser.html#composition_df"><code>composition_df</code></a>'s output to generate DataFrames that counts a player's units in a specific period of time.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The following are tables show the DataFrames that result from counting the units in the sample composition DataFrame.</p>
<p>Wole game table:</p>
<table>
<thead><tr>
<th style="text-align:left">Unit</th>
<th style="text-align:right">started</th>
<th style="text-align:right">born</th>
<th style="text-align:right">died</th>
<th style="text-align:right">total</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">marauder</td>
<td style="text-align:right">5</td>
<td style="text-align:right">5</td>
<td style="text-align:right">nan</td>
<td style="text-align:right">5</td>
</tr>
<tr>
<td style="text-align:left">marine</td>
<td style="text-align:right">27</td>
<td style="text-align:right">27</td>
<td style="text-align:right">nan</td>
<td style="text-align:right">27</td>
</tr>
<tr>
<td style="text-align:left">medivac</td>
<td style="text-align:right">5</td>
<td style="text-align:right">5</td>
<td style="text-align:right">nan</td>
<td style="text-align:right">5</td>
</tr>
<tr>
<td style="text-align:left">raven</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">nan</td>
<td style="text-align:right">1</td>
</tr>
</tbody>
</table>
<p>Early game:</p>
<table>
<thead><tr>
<th style="text-align:left">Unit</th>
<th style="text-align:right">started</th>
<th style="text-align:right">born</th>
<th style="text-align:right">died</th>
<th style="text-align:right">total</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">marine</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">nan</td>
<td style="text-align:right">1</td>
</tr>
</tbody>
</table>
<p>Mid-game:</p>
<table>
<thead><tr>
<th style="text-align:left">Unit</th>
<th style="text-align:right">started</th>
<th style="text-align:right">born</th>
<th style="text-align:right">died</th>
<th style="text-align:right">total</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">marine</td>
<td style="text-align:right">12</td>
<td style="text-align:right">12</td>
<td style="text-align:right">nan</td>
<td style="text-align:right">12</td>
</tr>
</tbody>
</table>
<p>Late game:</p>
<table>
<thead><tr>
<th style="text-align:left">Unit</th>
<th style="text-align:right">started</th>
<th style="text-align:right">born</th>
<th style="text-align:right">died</th>
<th style="text-align:right">total</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">marauder</td>
<td style="text-align:right">5</td>
<td style="text-align:right">5</td>
<td style="text-align:right">nan</td>
<td style="text-align:right">5</td>
</tr>
<tr>
<td style="text-align:left">marine</td>
<td style="text-align:right">14</td>
<td style="text-align:right">14</td>
<td style="text-align:right">nan</td>
<td style="text-align:right">14</td>
</tr>
<tr>
<td style="text-align:left">medivac</td>
<td style="text-align:right">5</td>
<td style="text-align:right">5</td>
<td style="text-align:right">nan</td>
<td style="text-align:right">5</td>
</tr>
<tr>
<td style="text-align:left">raven</td>
<td style="text-align:right">1</td>
<td style="text-align:right">1</td>
<td style="text-align:right">nan</td>
<td style="text-align:right">1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>After calculating a player's army composition or unit started counts, I need to format the output of the functions so that I can process them with the results of other matches.</p>
<p>In this regard, I considered two options. On the one hand, I could store counts for all units of all races for each player in every match. Following this approach, I would have a single set of replays for each player that would, by averaging all unit counts, express the general building preferences of each player. On the other hand, I could segregate the results by game race. This second option implies that I would have to keep three separate sets of replays per player. I would also have to process three profiles per player that express their preferences when playing each game race.</p>
<p>Although initially, I was inclined to opt for the first option, I decided on the second because it seems closer to the actual game experience. For example, in StarCraft II, players are classified separately in leagues when playing with different game races. Similarly, many of the game's achievements are repeated for each race. Thus, it felt more akin to the game experience to provide threes profiles. 
This second approach also means that each match's record will contain fewer blanc data points when processing the profiles, which safes storage and processing memory.</p>
<p>With this in mind, the last step of each module's functions is to complete their outcomes to include values for all the units or buildings of each player's race.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The following table demonstrates the result of the <a href="/sc_training/build_parser.html#complete_count"><code>complete_count</code></a> helper function as applyed to player 2's army composition for the whole game in the sample match.</p>
<table>
<thead><tr>
<th style="text-align:left"></th>
<th style="text-align:right">autoturret</th>
<th style="text-align:right">banshee</th>
<th style="text-align:right">battlecruiser</th>
<th style="text-align:right">cyclone</th>
<th style="text-align:right">ghost</th>
<th style="text-align:right">hellion</th>
<th style="text-align:right">marauder</th>
<th style="text-align:right">marine</th>
<th style="text-align:right">medivac</th>
<th style="text-align:right">raven</th>
<th style="text-align:right">reaper</th>
<th style="text-align:right">siegetank</th>
<th style="text-align:right">thor</th>
<th style="text-align:right">viking</th>
<th style="text-align:right">warhound</th>
<th style="text-align:right">widowmine</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Player2_ArmyComp</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">3</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">2</td>
<td style="text-align:right">5</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
<td style="text-align:right">0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="count_composicion" class="doc_header"><code>count_composicion</code><a href="https://github.com/HDavidEspinosa/sc_training/tree/master/sc_training/build_parser.py#L186" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>count_composicion</code>(<strong><code>rpl</code></strong>:<code>Replay</code>, <strong><code>pid</code></strong>:<code>int</code>, <strong><code>buildings</code></strong>:<code>bool</code>=<em><code>False</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">indexes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;whole&#39;</span><span class="p">,</span> <span class="s1">&#39;early&#39;</span><span class="p">,</span> <span class="s1">&#39;mid&#39;</span><span class="p">,</span> <span class="s1">&#39;late&#39;</span><span class="p">]</span>
<span class="n">test_army</span> <span class="o">=</span> <span class="n">count_composicion</span><span class="p">(</span><span class="n">sing_zerg</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">army_comp_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">test_army</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">indexes</span><span class="p">)</span>
<span class="n">army_comp_df</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>autoturret</th>
      <th>banshee</th>
      <th>battlecruiser</th>
      <th>cyclone</th>
      <th>ghost</th>
      <th>hellion</th>
      <th>marauder</th>
      <th>marine</th>
      <th>medivac</th>
      <th>raven</th>
      <th>reaper</th>
      <th>siegetank</th>
      <th>thor</th>
      <th>viking</th>
      <th>warhound</th>
      <th>widowmine</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>whole</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>10</td>
      <td>0</td>
      <td>14</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>early</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>mid</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
      <td>0</td>
      <td>7</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>late</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>10</td>
      <td>0</td>
      <td>14</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_buildings_comp</span> <span class="o">=</span> <span class="n">count_composicion</span><span class="p">(</span><span class="n">sing_zerg</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">buildings</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">buildings_comp_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">test_buildings_comp</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">indexes</span><span class="p">)</span>
<span class="n">buildings_comp_df</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>armory</th>
      <th>barracks</th>
      <th>bunker</th>
      <th>commandcenter</th>
      <th>engineeringbay</th>
      <th>factory</th>
      <th>fusioncore</th>
      <th>ghostacademy</th>
      <th>missileturret</th>
      <th>orbitalcommand</th>
      <th>planetaryfortress</th>
      <th>refinery</th>
      <th>sensortower</th>
      <th>starport</th>
      <th>supplydepot</th>
      <th>techlab</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>whole</th>
      <td>3</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>6</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
      <td>1</td>
      <td>6</td>
      <td>0</td>
      <td>2</td>
      <td>9</td>
      <td>0</td>
    </tr>
    <tr>
      <th>early</th>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>2</td>
      <td>0</td>
      <td>1</td>
      <td>2</td>
      <td>0</td>
    </tr>
    <tr>
      <th>mid</th>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>6</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
      <td>0</td>
      <td>4</td>
      <td>0</td>
      <td>1</td>
      <td>4</td>
      <td>0</td>
    </tr>
    <tr>
      <th>late</th>
      <td>3</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>6</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
      <td>1</td>
      <td>6</td>
      <td>0</td>
      <td>2</td>
      <td>9</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="count_started" class="doc_header"><code>count_started</code><a href="https://github.com/HDavidEspinosa/sc_training/tree/master/sc_training/build_parser.py#L212" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>count_started</code>(<strong><code>rpl</code></strong>:<code>Replay</code>, <strong><code>pid</code></strong>:<code>int</code>, <strong><code>buildings</code></strong>:<code>bool</code>=<em><code>False</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">army_training_count</span> <span class="o">=</span> <span class="n">count_started</span><span class="p">(</span><span class="n">sing_zerg</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">atc_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">army_training_count</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">indexes</span><span class="p">)</span>
<span class="n">atc_df</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>baneling</th>
      <th>broodling</th>
      <th>broodlord</th>
      <th>corruptor</th>
      <th>hydralisk</th>
      <th>infestedterran</th>
      <th>infestor</th>
      <th>infestorburrowed</th>
      <th>locust</th>
      <th>lurker</th>
      <th>mutalisk</th>
      <th>overlord</th>
      <th>overseer</th>
      <th>queen</th>
      <th>ravager</th>
      <th>roach</th>
      <th>swarmhost</th>
      <th>ultralisk</th>
      <th>viper</th>
      <th>zergling</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>whole</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>12</td>
      <td>0</td>
      <td>7</td>
      <td>11</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>10</td>
    </tr>
    <tr>
      <th>early</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>mid</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>7</td>
      <td>0</td>
      <td>4</td>
      <td>10</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>late</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
      <td>0</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>10</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">buildings_started_count</span> <span class="o">=</span> <span class="n">count_started</span><span class="p">(</span><span class="n">sing_zerg</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">buildings</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">bsc_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">buildings_started_count</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">indexes</span><span class="p">)</span>
<span class="n">bsc_df</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>banelingnest</th>
      <th>creeptumor</th>
      <th>evolutionchamber</th>
      <th>extractor</th>
      <th>greaterspire</th>
      <th>hatchery</th>
      <th>hive</th>
      <th>hydraliskden</th>
      <th>infestationpit</th>
      <th>lair</th>
      <th>lurkerden</th>
      <th>nydusnetwork</th>
      <th>nydusworm</th>
      <th>roachwarren</th>
      <th>spawningpool</th>
      <th>spinecrawler</th>
      <th>spire</th>
      <th>sporecrawler</th>
      <th>ultraliskcavern</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>whole</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>4</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>early</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>mid</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>late</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Base-Expansion">Base Expansion<a class="anchor-link" href="#Base-Expansion"> </a></h3><p>{% include warning.html content='UNDER DEVELOPMENT!!!' %}
To build their economy, players will, in most cases, establish more than one base. These expansions allow them to collect resources faster and to prevent running out of resources. To be precise, here, I define <em>expansion</em> as building the main base structure for the player's play race. These main structures are a Nexus for Protoss, a Command Center for Terrans, or a Hatchery for the Zerg.</p>
<p>The speed with which players build their first expansion serves as an indicator for their economic development strategy.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">get_expansion_time</span><span class="p">(</span><span class="n">rpl</span><span class="p">:</span> <span class="n">sc2reader</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">Replay</span><span class="p">,</span> <span class="n">pid</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
    <span class="n">bases</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Protoss&#39;</span><span class="p">:</span><span class="s1">&#39;nexus&#39;</span><span class="p">,</span> <span class="s1">&#39;Zerg&#39;</span><span class="p">:</span><span class="s1">&#39;hatchery&#39;</span><span class="p">,</span> <span class="s1">&#39;Terran&#39;</span><span class="p">:</span><span class="s1">&#39;commandcenter&#39;</span><span class="p">}</span>
    <span class="n">expansions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;exp1&#39;</span><span class="p">,</span><span class="s1">&#39;exp2&#39;</span><span class="p">,</span><span class="s1">&#39;exp3&#39;</span><span class="p">,</span><span class="s1">&#39;exp4&#39;</span><span class="p">]</span>
    <span class="n">player_race</span> <span class="o">=</span> <span class="n">rpl</span><span class="o">.</span><span class="n">player</span><span class="p">[</span><span class="n">pid</span><span class="p">]</span><span class="o">.</span><span class="n">play_race</span>
    
    <span class="n">units_df</span> <span class="o">=</span> <span class="n">composition_df</span><span class="p">(</span><span class="n">rpl</span><span class="p">,</span> <span class="n">pid</span><span class="p">,</span> <span class="n">buildings</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">bases_df</span> <span class="o">=</span> <span class="n">units_df</span><span class="p">[</span><span class="s1">&#39;Unit&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">units_df</span><span class="o">.</span><span class="n">Unit</span> <span class="o">==</span> <span class="n">bases</span><span class="p">[</span><span class="n">player_race</span><span class="p">])]</span>

    <span class="k">return</span> <span class="n">units_df</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># print(get_expansion_time(zerg_test, 1))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Player-Tech-Update">Player Tech Update<a class="anchor-link" href="#Player-Tech-Update"> </a></h3><p>Beyond buildings and training units, the third way players can spend their resources is by researching tech updates. 
However, contrary to units and buildings, player objects do not store a list of tech upgrades. Thus, I use the match's  <code>UpgradeCompleteEvent</code> to build this list. Bear in mind that, instead of recording a count for each upgrade, I can record the second at which the update takes place. I can do this because each type of update can only occur once every game. 
In the player profile, I can average the times a player researched a particular update, ignoring any matches when they didn't, to get an approximate measure of when they prefer to make any update. I can also count the number of times they research each upgrade to see what upgrades they favour.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="list_player_upgrades" class="doc_header"><code>list_player_upgrades</code><a href="https://github.com/HDavidEspinosa/sc_training/tree/master/sc_training/build_parser.py#L229" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>list_player_upgrades</code>(<strong><code>rpl</code></strong>:<code>Replay</code>, <strong><code>pid</code></strong>:<code>int</code>)</p>
</blockquote>
<p>Lists the times at wich the player completed their updates</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">player1_upgrades</span> <span class="o">=</span> <span class="n">list_player_upgrades</span><span class="p">(</span><span class="n">sing_zerg</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">player1_upgrades</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Player1_upgrades&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;BansheeCloak&#39;: 0,
 &#39;BansheeSpeed&#39;: 0,
 &#39;BattlecruiserEnableSpecializations&#39;: 0,
 &#39;CycloneLockOnDamageUpgrade&#39;: 546.3041002277904,
 &#39;DrillClaws&#39;: 427.7596810933941,
 &#39;EnhancedShockwaves&#39;: 0,
 &#39;HiSecAutoTracking&#39;: 0,
 &#39;HighCapacityBarrels&#39;: 347.77790432801817,
 &#39;LiberatorAGRangeUpgrade&#39;: 0,
 &#39;MedivacIncreaseSpeedBoost&#39;: 0,
 &#39;PersonalCloaking&#39;: 0,
 &#39;PunisherGrenades&#39;: 0,
 &#39;RavenCorvidReactor&#39;: 0,
 &#39;ShieldWall&#39;: 0,
 &#39;SmartServos&#39;: 526.3086560364465,
 &#39;Stimpack&#39;: 0,
 &#39;TerranBuildingArmor&#39;: 0,
 &#39;TerranInfantryArmorsLevel1&#39;: 0,
 &#39;TerranInfantryArmorsLevel2&#39;: 0,
 &#39;TerranInfantryArmorsLevel3&#39;: 0,
 &#39;TerranInfantryWeaponsLevel1&#39;: 0,
 &#39;TerranInfantryWeaponsLevel2&#39;: 0,
 &#39;TerranInfantryWeaponsLevel3&#39;: 0,
 &#39;TerranShipWeaponsLevel1&#39;: 0,
 &#39;TerranShipWeaponsLevel2&#39;: 0,
 &#39;TerranShipWeaponsLevel3&#39;: 0,
 &#39;TerranVehicleAndShipArmorsLevel1&#39;: 0,
 &#39;TerranVehicleAndShipArmorsLevel2&#39;: 0,
 &#39;TerranVehicleAndShipArmorsLevel3&#39;: 0,
 &#39;TerranVehicleWeaponsLevel1&#39;: 574.1548974943053,
 &#39;TerranVehicleWeaponsLevel2&#39;: 0,
 &#39;TerranVehicleWeaponsLevel3&#39;: 0}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

