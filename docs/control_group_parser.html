---

title: Chapter 6 - Tracking Control Groups


keywords: fastai
sidebar: home_sidebar



nb_path: "06_control_group_parser.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 06_control_group_parser.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In this chapter, I explore the data from the game's <code>ControlGroupEvents</code> and I define the module <code>controlgroup_parser</code> to compile this information as an indicator of the players' tactical performance.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="CtrlGrpPlugin" class="doc_header"><code>class</code> <code>CtrlGrpPlugin</code><a href="https://github.com/HDavidEspinosa/sc_training/tree/master/sc_training/controlgroup_parser.py#L23" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>CtrlGrpPlugin</code>()</p>
</blockquote>
<p>Tracks the composition of the Replay's Players Control Groups.</p>
<p>Using this plug-in, the Replay object will include the <code>ctrl_grp_trk</code>
attribute. This attribute will store a dictionary of the control group
compositions using the replay's human players' ids (<code>pid</code>) as keys.
i.e.:</p>

<pre><code>    `dict[pid (int):  control_group_compositions (dict)]`

</code></pre>
<p>Each of these dictionaries uses the <code>second</code> attribute of a
<code>ControlGroupEvent</code> as an index and organises the control group
composition as one more dictionary, indexed with the integers 1 to 9,
which stores a list of units that compose each one of the nine control
groups of the player. i.e.</p>

<pre><code>`dict[pid(int): dict[second(int): dict[group(int): list_of_units]]]`</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Load sample replays</span>


<span class="n">RPS_PATH</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;./test_replays&quot;</span><span class="p">)</span>

<span class="n">game_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">RPS_PATH</span><span class="o">/</span><span class="s2">&quot;Jagannatha LE.SC2Replay&quot;</span><span class="p">)</span>
<span class="n">single_replay</span> <span class="o">=</span> <span class="n">sc2reader</span><span class="o">.</span><span class="n">load_replay</span><span class="p">(</span><span class="n">game_path</span><span class="p">)</span>
<span class="n">ctrl_grp_test</span> <span class="o">=</span> <span class="n">sc2reader</span><span class="o">.</span><span class="n">load_replay</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">RPS_PATH</span><span class="o">/</span><span class="s1">&#39;ctrl_grp_t.SC2Replay&#39;</span><span class="p">))</span>

<span class="n">ta_test</span> <span class="o">=</span> <span class="n">sc2reader</span><span class="o">.</span><span class="n">load_replay</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">RPS_PATH</span><span class="o">/</span><span class="s1">&#39;Terran_abilities.SC2Replay&#39;</span><span class="p">))</span>
<span class="n">pa_test</span> <span class="o">=</span> <span class="n">sc2reader</span><span class="o">.</span><span class="n">load_replay</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">RPS_PATH</span><span class="o">/</span><span class="s1">&#39;ProtossAbilities.SC2Replay&#39;</span><span class="p">))</span>

<span class="n">tms_test</span> <span class="o">=</span> <span class="n">sc2reader</span><span class="o">.</span><span class="n">load_replay</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">RPS_PATH</span><span class="o">/</span><span class="s1">&#39;TMovesSelect.SC2Replay&#39;</span><span class="p">))</span>
<span class="n">pms_test</span> <span class="o">=</span> <span class="n">sc2reader</span><span class="o">.</span><span class="n">load_replay</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">RPS_PATH</span><span class="o">/</span><span class="s1">&#39;p_move_test.SC2Replay&#39;</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">ctrl_grp_test</span><span class="o">.</span><span class="n">length</span><span class="o">.</span><span class="n">seconds</span><span class="p">)</span>
<span class="n">ctrl_grp_test</span><span class="o">.</span><span class="n">ctrl_grp_trk</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>535
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>dict_keys([0, 37, 49, 56, 59, 60, 67, 79, 100, 103, 116, 125, 142, 146, 160, 165, 176, 179, 190, 193, 194, 229, 233, 244, 249, 255, 276, 280, 303, 310, 328, 333, 387, 408, 415, 428, 444, 450, 455, 487, 497, 525, 550, 565, 584, 586, 608, 629, 640, 644, 657, 667, 699, 700, 718, 723, 726])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">TEST_MATCH</span> <span class="o">=</span> <span class="n">ctrl_grp_test</span>

<span class="n">ctrl_grp_e</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">TEST_MATCH</span><span class="o">.</span><span class="n">events</span> 
              <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">sc2reader</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">ControlGroupEvent</span><span class="p">)</span>
              <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">pid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>

<span class="n">set_ctrl_grp</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">ctrl_grp_e</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">sc2reader</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">SetControlGroupEvent</span><span class="p">)]</span>

<span class="n">get_ctrl_grp</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">ctrl_grp_e</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">sc2reader</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">GetControlGroupEvent</span><span class="p">)]</span>

<span class="n">add_ctrl_grp</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">ctrl_grp_e</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> 
                              <span class="n">sc2reader</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">AddToControlGroupEvent</span><span class="p">)]</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ControlGroupEvents: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">ctrl_grp_e</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;SetControlGroupEvents: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">set_ctrl_grp</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;GetControlGroupEvents: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">get_ctrl_grp</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;AddControlGroupEvents: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">add_ctrl_grp</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>ControlGroupEvents: 57
SetControlGroupEvents: 10
GetControlGroupEvents: 47
AddControlGroupEvents: 6
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>TODO:
Define functions:</p>

<pre><code>- `calc_ctrlg_ratio` to get the ratios of control group actions v commands for the different stages of the game. 
    - Should this ratio be calculated adding this commands to the action count?
    - Maybe is better just to get a count?
- `max_active_groups` get the maxium number of active control groups per game stage
- `calc_group_select_ratio` can I calculate a ratio of selecting with group vs selecting in total (group and rightclick)?</code></pre>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">calc_ctrlg_ratio</span><span class="p">(</span><span class="n">rpl</span><span class="p">:</span> <span class="n">sc2reader</span><span class="o">.</span><span class="n">resources</span><span class="o">.</span><span class="n">Replay</span><span class="p">,</span> <span class="n">pid</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

