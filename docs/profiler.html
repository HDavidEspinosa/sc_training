---

title: Section 2 - Player Profiler


keywords: fastai
sidebar: home_sidebar



nb_path: "08_profiler.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 08_profiler.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Introduction">Introduction<a class="anchor-link" href="#Introduction"> </a></h2><p>In this section, I use the database built in Section 1.7 to define a <code>player_profiler</code> function that will take the data of each player's performances and then it will process it to compile three player profiles for each player, each corresponding to one of the play races of StarCraft 2. The section compiles this function into the <code>profiler</code> module.</p>
<p>The following code shows the players in the data base that have more than 2 replays in the database.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">working_db</span> <span class="o">=</span> <span class="n">set_up_db</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">players_match_count</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">working_db</span><span class="p">[</span><span class="s1">&#39;replays&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">player</span> <span class="ow">in</span> <span class="n">rec</span><span class="p">[</span><span class="s1">&#39;players&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">player</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;A.I.&#39;</span><span class="p">)</span> 
                <span class="ow">or</span> <span class="n">player</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;llll&#39;</span><span class="p">)</span>
                <span class="ow">or</span> <span class="n">player</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Player 2&#39;</span><span class="p">)):</span>
            <span class="n">players_match_count</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">player</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">players_match_count</span><span class="p">[</span><span class="n">player</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>
            
<span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">count</span> <span class="k">for</span> <span class="n">name</span> <span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">players_match_count</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">}</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;HDEspino&#39;: 149,
 &#39;DaveyC&#39;: 2,
 &#39;Xnorms&#39;: 2,
 &#39;Shah&#39;: 3,
 &#39;Razer&#39;: 2,
 &#39;gae&#39;: 2,
 &#39;SenorCat&#39;: 2,
 &#39;Worawit&#39;: 2,
 &#39;aria&#39;: 2,
 &#39;xiiaoyao&#39;: 2}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Of this players I will focus only on <code>HDEspino</code> given that the player has a substancial number of replays.</p>
<p>In any case, once I have a list of user names in a database, I can extract all the replays replative to that player with simple queries to the data base.</p>
<p>For example, the following queries extract all replays were <code>HDEspino</code> was playing either as player one or two.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">([</span><span class="n">rpl</span> <span class="k">for</span> <span class="n">rpl</span> 
           <span class="ow">in</span> <span class="n">working_db</span><span class="p">[</span><span class="s1">&#39;replays&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s1">&#39;players.0.username&#39;</span><span class="p">:</span><span class="s1">&#39;HDEspino&#39;</span><span class="p">,</span>
                                          <span class="s1">&#39;players.0.race&#39;</span><span class="p">:</span><span class="s1">&#39;Protoss&#39;</span><span class="p">})]))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">([</span><span class="n">rpl</span> <span class="k">for</span> <span class="n">rpl</span> 
           <span class="ow">in</span> <span class="n">working_db</span><span class="p">[</span><span class="s1">&#39;replays&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s1">&#39;players.1.username&#39;</span><span class="p">:</span><span class="s1">&#39;HDEspino&#39;</span><span class="p">,</span>
                                          <span class="s1">&#39;players.1.race&#39;</span><span class="p">:</span><span class="s1">&#39;Protoss&#39;</span><span class="p">})]))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>91
39
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Based on this list, I will build the Protoss profile for this player to illustrate what this process would entail.</p>
<p>First, I will query the system to identify the replays where the user was one of the players and was playing as Protoss. Then, I use that information to build a DataFrame containing all of the indicators for the player's performances in these replays.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">player_1_protoss</span> <span class="o">=</span> <span class="p">[</span><span class="n">rpl</span><span class="p">[</span><span class="s1">&#39;replay_name&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">rpl</span> 
                   <span class="ow">in</span> <span class="n">working_db</span><span class="p">[</span><span class="s1">&#39;replays&#39;</span><span class="p">]</span><span class="o">.</span>
                      <span class="n">find</span><span class="p">({</span><span class="s1">&#39;players.0.username&#39;</span><span class="p">:</span><span class="s1">&#39;HDEspino&#39;</span><span class="p">,</span> 
                            <span class="s1">&#39;players.0.race&#39;</span><span class="p">:</span><span class="s1">&#39;Protoss&#39;</span><span class="p">},</span>
                            <span class="p">{</span><span class="s1">&#39;replay_name&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;players&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">})]</span>

<span class="n">working_repls</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">rpl</span> <span class="ow">in</span> <span class="n">player_1_protoss</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">cur</span> <span class="ow">in</span> <span class="n">working_db</span><span class="p">[</span><span class="s1">&#39;indicators&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s1">&#39;replay_name&#39;</span><span class="p">:</span><span class="n">rpl</span><span class="p">,</span> 
                                              <span class="s1">&#39;player_id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span> 
                                             <span class="p">{</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;replay_name&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                                              <span class="s1">&#39;player_username&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                                              <span class="s1">&#39;player_id&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}):</span>
        <span class="n">working_repls</span><span class="p">[</span><span class="n">rpl</span><span class="p">]</span> <span class="o">=</span> <span class="n">cur</span>
        
<span class="nb">len</span><span class="p">(</span><span class="n">working_repls</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>91</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">player_2_protoss</span> <span class="o">=</span> <span class="p">[</span><span class="n">rpl</span><span class="p">[</span><span class="s1">&#39;replay_name&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">rpl</span> 
                   <span class="ow">in</span> <span class="n">working_db</span><span class="p">[</span><span class="s1">&#39;replays&#39;</span><span class="p">]</span><span class="o">.</span>
                      <span class="n">find</span><span class="p">({</span><span class="s1">&#39;players.1.username&#39;</span><span class="p">:</span><span class="s1">&#39;HDEspino&#39;</span><span class="p">,</span> 
                            <span class="s1">&#39;players.1.race&#39;</span><span class="p">:</span><span class="s1">&#39;Protoss&#39;</span><span class="p">},</span>
                            <span class="p">{</span><span class="s1">&#39;replay_name&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;players&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">})]</span>

<span class="k">for</span> <span class="n">rpl</span> <span class="ow">in</span> <span class="n">player_2_protoss</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">cur</span> <span class="ow">in</span> <span class="n">working_db</span><span class="p">[</span><span class="s1">&#39;indicators&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s1">&#39;replay_name&#39;</span><span class="p">:</span><span class="n">rpl</span><span class="p">,</span> 
                                              <span class="s1">&#39;player_id&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span> 
                                             <span class="p">{</span><span class="s1">&#39;_id&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;replay_name&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                                              <span class="s1">&#39;player_username&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                                              <span class="s1">&#39;player_id&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}):</span>
        <span class="n">working_repls</span><span class="p">[</span><span class="n">rpl</span><span class="p">]</span> <span class="o">=</span> <span class="n">cur</span>
        
<span class="nb">len</span><span class="p">(</span><span class="n">working_repls</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>130</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">working_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">working_repls</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">index</span><span class="o">=</span><span class="n">working_repls</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">working_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="k">if</span> <span class="s1">&#39;pref&#39;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;first_whole_pref_sab&#39;,
 &#39;second_whole_pref_sab&#39;,
 &#39;first_early_pref_sab&#39;,
 &#39;second_early_pref_sab&#39;,
 &#39;first_mid_pref_sab&#39;,
 &#39;second_mid_pref_sab&#39;,
 &#39;first_late_pref_sab&#39;,
 &#39;second_late_pref_sab&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">working_repls</span><span class="p">[[</span><span class="s1">&#39;first_whole_pref_sab&#39;</span><span class="p">,</span>
 <span class="s1">&#39;second_whole_pref_sab&#39;</span><span class="p">,</span>
 <span class="s1">&#39;first_early_pref_sab&#39;</span><span class="p">,</span>
 <span class="s1">&#39;second_early_pref_sab&#39;</span><span class="p">,</span>
 <span class="s1">&#39;first_mid_pref_sab&#39;</span><span class="p">,</span>
 <span class="s1">&#39;second_mid_pref_sab&#39;</span><span class="p">,</span>
 <span class="s1">&#39;first_late_pref_sab&#39;</span><span class="p">,</span>
 <span class="s1">&#39;second_late_pref_sab&#39;</span><span class="p">]]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-intense-fg ansi-bold">---------------------------------------------------------------------------</span>
<span class="ansi-red-intense-fg ansi-bold">TypeError</span>                                 Traceback (most recent call last)
<span class="ansi-green-intense-fg ansi-bold">~\AppData\Local\Temp/ipykernel_3880/739817364.py</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">----&gt; 1</span><span class="ansi-yellow-intense-fg ansi-bold"> working_repls[[&#39;first_whole_pref_sab&#39;,
</span><span class="ansi-green-fg">      2</span>  <span class="ansi-blue-intense-fg ansi-bold">&#39;second_whole_pref_sab&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">,</span>
<span class="ansi-green-fg">      3</span>  <span class="ansi-blue-intense-fg ansi-bold">&#39;first_early_pref_sab&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">,</span>
<span class="ansi-green-fg">      4</span>  <span class="ansi-blue-intense-fg ansi-bold">&#39;second_early_pref_sab&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">,</span>
<span class="ansi-green-fg">      5</span>  <span class="ansi-blue-intense-fg ansi-bold">&#39;first_mid_pref_sab&#39;</span><span class="ansi-yellow-intense-fg ansi-bold">,</span>

<span class="ansi-red-intense-fg ansi-bold">TypeError</span>: unhashable type: &#39;list&#39;</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

