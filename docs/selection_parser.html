---

title: Chapter 6 - Tracking Control Groups


keywords: fastai
sidebar: home_sidebar



nb_path: "06_selection_parser.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 06_selection_parser.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Introduction">Introduction<a class="anchor-link" href="#Introduction"> </a></h2><p>Beyond <code>CommandEvents</code> (see &lt;&lt;Chapter 5 - Handling Command Events&gt;&gt;), another potential indicator that I can use to profile the players' tactical play (i.e. their micro-game) is their <strong>selection behaviour</strong>. For instance, in StarCraft II, players can select units in two ways; they can use their mouse in conjunction with some hotkeys like <code>ctrl</code> or use control groups to assemble sets of units for custom and fast selection.</p>
<p>This chapter explores how I can extract information about this behaviour with sc2reader's <code>SelectionEvents</code> and <code>ControlGroupEvents</code>. Using these events, I define a set of functions to quantify this characteristic of the players' play.</p>
<h3 id="Exported-Functions:">Exported Functions:<a class="anchor-link" href="#Exported-Functions:"> </a></h3><ul>
<li><a href="/sc_training/selection_parser.html#calc_ctrlg_ratio"><code>calc_ctrlg_ratio</code></a></li>
<li><a href="/sc_training/selection_parser.html#count_max_active_groups"><code>count_max_active_groups</code></a></li>
<li><a href="/sc_training/selection_parser.html#calc_get_ctrl_grp_ratio"><code>calc_get_ctrl_grp_ratio</code></a></li>
<li><a href="/sc_training/selection_parser.html#calc_select_ratio"><code>calc_select_ratio</code></a> </li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Extracting-the-Control-Group-Compositions">Extracting the Control Group Compositions<a class="anchor-link" href="#Extracting-the-Control-Group-Compositions"> </a></h2><p>Before examining the structure of the <code>ControlGroupEvents</code> and the <code>SelectionEvents</code>, I must explain how to load <code>Replays</code> to include enough information to quantify the abovementioned indicators.  The issue is that loading <code>Replays</code> with <code>sc2reader</code> as I have in previous modules does not record the composition of the players' control groups over time. This can be remediated to an extent using the <code>sc2reader</code> plug-in <code>SelectionTracker</code>, which is similar to the <code>APMTracker</code> I use in &lt;&lt;Chapter 5 -Handling Command Events&gt;&gt;. However, in contrast with <code>APMTracker</code>, <code>SelectionTracker</code> is meant as an input for user-defined plug-ins that specify its behaviour. 
{% include note.html content='this chapter&#8217;s development notebook defines the module <code>selection_parser</code>, which exports the class <a href="/sc_training/selection_parser.html#CtrlGroupTracker"><code>CtrlGroupTracker</code></a> that can be used as an <code>sc2reader</code> plug-in. This plug-in adds the <code>ctrl_grp_trk</code> attribute to the <code>Replay</code> objects upon load. This attribute stores the composition of the players&#8217; control groups each time the player triggers a <code>ControlGroupEvent</code> during the match. See the notebook or the module&#8217;s source code for implementation details. ' %}</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h5 id="CtrlGroupTracker" class="doc_header"><code>class</code> <code>CtrlGroupTracker</code><a href="https://github.com/HDavidEspinosa/sc_training/tree/master/sc_training/ingest/selection_parser.py#L23" class="source_link" style="float:right">[source]</a></h5><blockquote><p><code>CtrlGroupTracker</code>()</p>
</blockquote>
<p>Tracks the composition of the Replay's Players Control Groups.</p>
<p>Using this plug-in, the Replay object will include the <code>ctrl_grp_trk</code>
attribute. This attribute will store a dictionary of the control group
compositions using the replay's human players' ids (<code>pid</code>) as keys.
i.e.:
    <code>dict[pid (int):  control_group_compositions (dict)]</code></p>
<p>Each of these dictionaries uses the <code>second</code> attribute of a
<code>ControlGroupEvent</code> as an index and organises the control group
composition as one more dictionary, indexed with the integers 1 to 9,
which stores a list of units that compose each one of the nine control
groups of the player. i.e.</p>
<p><code>dict[pid(int): dict[second(int): dict[group(int): list_of_units]]]</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Selection-Behaviour-Events">Selection Behaviour Events<a class="anchor-link" href="#Selection-Behaviour-Events"> </a></h2><p>As stated above, in this chapter, I take a look into two kinds of <code>GameEvents</code> that I can use to get a notion of the players' selection behaviours, i.e. <code>ControlGroupEvents</code> and <code>SelectonEvents</code>.</p>
<h3 id="Handling-ControlGroupEvents">Handling <code>ControlGroupEvents</code><a class="anchor-link" href="#Handling-ControlGroupEvents"> </a></h3><p>I will start by loading the sample <code>Replays</code> I use in this notebook to analyse this type of event.
{% include note.html content='In the following code, the first command registers that <a href="/sc_training/selection_parser.html#CtrlGroupTracker"><code>CtrlGroupTracker</code></a> plug-in I define above.
' %}</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Register CtrlGroupTracker plug-in</span>
<span class="n">sc2reader</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">register_plugin</span><span class="p">(</span><span class="n">CtrlGroupTracker</span><span class="p">())</span>

<span class="c1"># Load sample replays</span>
<span class="n">RPS_PATH</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;./test_replays&quot;</span><span class="p">)</span>

<span class="n">game_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">RPS_PATH</span><span class="o">/</span><span class="s2">&quot;Jagannatha LE.SC2Replay&quot;</span><span class="p">)</span>
<span class="n">single_replay</span> <span class="o">=</span> <span class="n">sc2reader</span><span class="o">.</span><span class="n">load_replay</span><span class="p">(</span><span class="n">game_path</span><span class="p">)</span>
<span class="n">ctrl_grp_test</span> <span class="o">=</span> <span class="n">sc2reader</span><span class="o">.</span><span class="n">load_replay</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">RPS_PATH</span><span class="o">/</span><span class="s1">&#39;ctrl_grp_t.SC2Replay&#39;</span><span class="p">))</span>
<span class="n">ctrl_grp_test_2</span> <span class="o">=</span> <span class="n">sc2reader</span><span class="o">.</span><span class="n">load_replay</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">RPS_PATH</span><span class="o">/</span><span class="s1">&#39;ctrl_grp_t_2.SC2Replay&#39;</span><span class="p">))</span>

<span class="n">ta_test</span> <span class="o">=</span> <span class="n">sc2reader</span><span class="o">.</span><span class="n">load_replay</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">RPS_PATH</span><span class="o">/</span><span class="s1">&#39;Terran_abilities.SC2Replay&#39;</span><span class="p">))</span>
<span class="n">pa_test</span> <span class="o">=</span> <span class="n">sc2reader</span><span class="o">.</span><span class="n">load_replay</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">RPS_PATH</span><span class="o">/</span><span class="s1">&#39;ProtossAbilities.SC2Replay&#39;</span><span class="p">))</span>

<span class="n">tms_test</span> <span class="o">=</span> <span class="n">sc2reader</span><span class="o">.</span><span class="n">load_replay</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">RPS_PATH</span><span class="o">/</span><span class="s1">&#39;TMovesSelect.SC2Replay&#39;</span><span class="p">))</span>
<span class="n">pms_test</span> <span class="o">=</span> <span class="n">sc2reader</span><span class="o">.</span><span class="n">load_replay</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">RPS_PATH</span><span class="o">/</span><span class="s1">&#39;p_move_test.SC2Replay&#39;</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>With <code>Replays</code> loaded, one can see that they now have the <code>ctrl_grp_trk</code> attribute. Calling this attribute, I can choose to look at each of the players' <strong>control group compositions</strong> using their <code>pid</code> as an index. Afterwards, I can look at each composition independently using the value of the <code>second</code> attribute of the <code>ControlGroupEvent</code> that generated it as an index.
{% include tip.html content='in the sample code, TEST_PID stores the sample player&#8217;s player ID (<code>pid</code>). Meanwhile, the number 221, which I use to extract a sample composition, refers to the time index of the event that triggered its recording.' %}</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">TEST_MATCH</span> <span class="o">=</span> <span class="n">single_replay</span>
<span class="n">TEST_PID</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">sample_ctrlg_comp</span> <span class="o">=</span> <span class="n">TEST_MATCH</span><span class="o">.</span><span class="n">ctrl_grp_trk</span><span class="p">[</span><span class="n">TEST_PID</span><span class="p">][</span><span class="mi">221</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;LOAD RESULTS:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Ctrl group compositions: </span><span class="si">{</span><span class="n">sample_ctrlg_comp</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---------------------------&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Sample Ctrl group composition:&#39;</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">TEST_MATCH</span><span class="o">.</span><span class="n">ctrl_grp_trk</span><span class="p">[</span><span class="n">TEST_PID</span><span class="p">][</span><span class="mi">221</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----------------------------&#39;</span><span class="p">)</span>

<span class="n">sample_event</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">TEST_MATCH</span><span class="o">.</span><span class="n">events</span> 
              <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">sc2reader</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">ControlGroupEvent</span><span class="p">)</span>
              <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">pid</span> <span class="o">==</span> <span class="p">(</span><span class="n">TEST_PID</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
              <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">second</span> <span class="o">==</span> <span class="mi">221</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Sample </span><span class="si">{</span><span class="n">sample_event</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Generated by: </span><span class="si">{</span><span class="n">sample_event</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">player</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Recorded time: </span><span class="si">{</span><span class="n">sample_event</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">second</span><span class="si">}</span><span class="s1">second&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>LOAD RESULTS:
Ctrl group compositions: {1: [OrbitalCommand [3100001]], 2: [SCV [3440001]], 3: [OrbitalCommand [3100001]], 4: [Factory [3B80001]], 5: [OrbitalCommand [3100001]], 6: [], 7: [], 8: [], 9: []}
---------------------------
Sample Ctrl group composition:
{1: [OrbitalCommand [3100001]],
 2: [SCV [3440001]],
 3: [OrbitalCommand [3100001]],
 4: [Factory [3B80001]],
 5: [OrbitalCommand [3100001]],
 6: [],
 7: [],
 8: [],
 9: []}
----------------------------
Sample GetControlGroupEvent
Generated by: Player 2 - MxChrisxM (Terran)
Recorded time: 221second
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>{% include note.html content='in the composition, nine lists track the units that belong to each of the nine control groups that players can assign in the game.' %}</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Beyond the control group compositions, I can use simple <em>list comprehensions</em> to extract the <code>ControlGroupEvents</code> from the <code>Replay's</code> event list.
With this technique, I can also segregate these events into three sub-types:</p>
<ul>
<li><code>SetControlGroupEvent</code>: created each time a player assigns a control group.</li>
<li><code>GetControlGroupEvent</code>: registered each time a player summons, i.e. uses a hot-key to select a control group.</li>
<li><code>AddToControlGroupEvent</code>: registered when a player uses a hot-key to assign selected units to an existing control group.</li>
</ul>
<p>This classification is helpful to distinguish between events that select units and those that do not.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#List all ControlGroupEvents</span>
<span class="n">ctrl_grp_e</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">TEST_MATCH</span><span class="o">.</span><span class="n">events</span> 
              <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">sc2reader</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">ControlGroupEvent</span><span class="p">)</span>
              <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">pid</span> <span class="o">==</span> <span class="p">(</span><span class="n">TEST_PID</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>

<span class="c1">#List ControlGroupEvents sub-types</span>
<span class="n">set_ctrl_grp</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">ctrl_grp_e</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">sc2reader</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">SetControlGroupEvent</span><span class="p">)]</span>

<span class="n">get_ctrl_grp</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">ctrl_grp_e</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">sc2reader</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">GetControlGroupEvent</span><span class="p">)]</span>

<span class="n">add_ctrl_grp</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">ctrl_grp_e</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> 
                              <span class="n">sc2reader</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">AddToControlGroupEvent</span><span class="p">)]</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ControlGroupEvents: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">ctrl_grp_e</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;SetControlGroupEvents: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">set_ctrl_grp</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;GetControlGroupEvents: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">get_ctrl_grp</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;AddControlGroupEvents: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">add_ctrl_grp</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>ControlGroupEvents: 100
SetControlGroupEvents: 14
GetControlGroupEvents: 86
AddControlGroupEvents: 0
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Meanwhile, with a simple loop I can go through a control group composition group-lists to count how many of them actually have units assign to them as shown in the code bellow.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">count</span> <span class="o">=</span> <span class="mi">0</span> 
<span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">sample_ctrlg_comp</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">l</span><span class="p">:</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span> 

<span class="n">count</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>5</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In this module, I define an internal function called <a href="/sc_training/selection_parser.html#count_active_groups"><code>count_active_groups</code></a> that carries out this task.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># count_active_groups sample run</span>
<span class="n">count_active_groups</span><span class="p">(</span><span class="n">sample_ctrlg_comp</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>5</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Handling-SelectionEvents">Handling <code>SelectionEvents</code><a class="anchor-link" href="#Handling-SelectionEvents"> </a></h3><p>As explained in <code>sc2reader's</code> documentation,</p>
<blockquote><p>:"<code>SelectionEvents</code> are generated when ever the active selection of the player is updated. Unlike other game events, these events can also be generated by non-player actions like unit deaths or transformations. [...] selection events targetting control group buffers are also generated when control group selections are modified by non-player actions. When a player action updates a control group a <code>ControlGroupEvent</code> is generated." <a href="https://sc2reader.readthedocs.io/en/latest/events/game.html">(Kim, 2015, p. 48)</a></p>
</blockquote>
<p>Hence, <code>SelectionEvents</code> events can refer to game situations that also trigger <code>ControlGroupEvents</code>, but they are essentially different.</p>
<p>Below, I extract the sample match's <code>SelectionEvents</code>. I also use their <code>control_group</code> attribute to see what control groups they are linked to. Note that there is a control group number ten according to the list of control groups linked to the selections. This group refers to the player's current active selection, whatever it was at the moment. In other words, if the player selects units just by clicking, it would trigger a <code>SelectionEvent</code> but not a <code>ControlGroupEvent</code>. Said <code>SelectionEvent</code> would be linked to the current selection instead of a control group.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">select_e</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">TEST_MATCH</span><span class="o">.</span><span class="n">events</span> 
              <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">sc2reader</span><span class="o">.</span><span class="n">events</span><span class="o">.</span><span class="n">game</span><span class="o">.</span><span class="n">SelectionEvent</span><span class="p">)</span>
              <span class="ow">and</span> <span class="n">e</span><span class="o">.</span><span class="n">pid</span> <span class="o">==</span> <span class="p">(</span><span class="n">TEST_PID</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;SelectionEvents in sample replay: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">select_e</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Groups referenced by the Selection Events:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">s</span><span class="o">.</span><span class="n">control_group</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">select_e</span><span class="p">]))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>SelectionEvents in sample replay: 215
Groups referenced by the Selection Events:
{1, 3, 4, 5, 10}
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Similarly, the following code exposes the intersection between the two sets. It shows how many <code>SelectionEvents</code> and <code>ControlGroupEvents</code> <code>sc2reader</code> registered independently and how many were triggered by the same game event.</p>
<p>Recognizing this link is crucial if I want to count the two types of events together. In this case, I need to make sure that I only count each game event once. The following code shows how the sets of events intersect, how simply adding the sets miss-counts the elements, and how I can use set-union to count them correctly.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sel_e_times</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">s</span><span class="o">.</span><span class="n">second</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">select_e</span><span class="p">])</span>
<span class="n">ctrl_grp_times</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">c</span><span class="o">.</span><span class="n">second</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">ctrl_grp_e</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;select_e_times_indexes: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">sel_e_times</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;ctrl_grp_times_indexes: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">ctrl_grp_times</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">intersect</span> <span class="o">=</span> <span class="n">sel_e_times</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">ctrl_grp_times</span><span class="p">)</span>
<span class="n">not_intersect_set</span> <span class="o">=</span> <span class="n">sel_e_times</span><span class="o">.</span><span class="n">symmetric_difference</span><span class="p">(</span><span class="n">ctrl_grp_times</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Number of elements that intersect: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">intersect</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Number of elements that do not intersect: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">not_intersect_set</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Sum of set counts: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">sel_e_times</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">ctrl_grp_times</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Union of select and ctrl_group: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">sel_e_times</span> <span class="o">|</span> <span class="n">ctrl_grp_times</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>select_e_times_indexes: 179
ctrl_grp_times_indexes: 85
Number of elements that intersect: 7
Number of elements that do not intersect: 250
Sum of set counts: 264
Union of select and ctrl_group: 257
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Functions">Functions<a class="anchor-link" href="#Functions"> </a></h2><h3 id="Helper-functions">Helper functions<a class="anchor-link" href="#Helper-functions"> </a></h3><p>Internally the module defines the helper functions:</p>
<ul>
<li><a href="/sc_training/selection_parser.html#build_ctrlg_df"><code>build_ctrlg_df</code></a> that builds a DataFrame with the <code>Replay's</code> list of <code>ControlGroupEvents</code>. </li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The table results from a sample run of <a href="/sc_training/selection_parser.html#build_ctrlg_df"><code>build_ctrlg_df</code></a> called on the notebooks <code>TEST_MATCH</code>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<table>
<thead><tr>
<th style="text-align:right"></th>
<th style="text-align:right">real_time</th>
<th style="text-align:right">second</th>
<th style="text-align:right">pid</th>
<th style="text-align:left">name</th>
<th style="text-align:right">control_group</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right">0</td>
<td style="text-align:right">4.28571</td>
<td style="text-align:right">6</td>
<td style="text-align:right">2</td>
<td style="text-align:left">SetControlGroupEvent</td>
<td style="text-align:right">1</td>
</tr>
<tr>
<td style="text-align:right">1</td>
<td style="text-align:right">4.28571</td>
<td style="text-align:right">6</td>
<td style="text-align:right">2</td>
<td style="text-align:left">SetControlGroupEvent</td>
<td style="text-align:right">2</td>
</tr>
<tr>
<td style="text-align:right">2</td>
<td style="text-align:right">4.28571</td>
<td style="text-align:right">6</td>
<td style="text-align:right">2</td>
<td style="text-align:left">SetControlGroupEvent</td>
<td style="text-align:right">3</td>
</tr>
<tr>
<td style="text-align:right">3</td>
<td style="text-align:right">5</td>
<td style="text-align:right">7</td>
<td style="text-align:right">2</td>
<td style="text-align:left">SetControlGroupEvent</td>
<td style="text-align:right">4</td>
</tr>
<tr>
<td style="text-align:right">4</td>
<td style="text-align:right">5</td>
<td style="text-align:right">7</td>
<td style="text-align:right">2</td>
<td style="text-align:left">SetControlGroupEvent</td>
<td style="text-align:right">5</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Exportable-Functions">Exportable Functions<a class="anchor-link" href="#Exportable-Functions"> </a></h3><p>Considering all of the above, I define multiple functions to extract the players' <em>seclection behaviour</em> indicators.</p>
<p>These functions include:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="count_max_active_groups" class="doc_header"><code>count_max_active_groups</code><a href="https://github.com/HDavidEspinosa/sc_training/tree/master/sc_training/ingest/selection_parser.py#L97" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>count_max_active_groups</code>(<strong><code>rpl</code></strong>:<code>Replay</code>, <strong><code>pid</code></strong>:<code>int</code>)</p>
</blockquote>
<p>Counts the maximum number of active control groups during the
different stages of the game.</p>
<p><em>Args</em></p>

<pre><code>- rpl (sc2reader.resources.Replay)
    The replay being analysed.
- pid (int)
    In-game player ID of the player being considered in the
    analysis.

</code></pre>
<p><em>Returns</em></p>

<pre><code>- dict[str, int]
    Maximum number of active control groups at each game stage
    indexed with the keys [stage]_max_act_grps</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="/sc_training/selection_parser.html#count_max_active_groups"><code>count_max_active_groups</code></a> sample run:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">count_max_active_groups</span><span class="p">(</span><span class="n">TEST_MATCH</span><span class="p">,</span> <span class="n">TEST_PID</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;whole_max_act_grps&#39;: 5,
 &#39;early_max_act_grps&#39;: 5,
 &#39;mid_max_act_grps&#39;: 5,
 &#39;late_max_act_grps&#39;: 5}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="calc_ctrlg_ratio" class="doc_header"><code>calc_ctrlg_ratio</code><a href="https://github.com/HDavidEspinosa/sc_training/tree/master/sc_training/ingest/selection_parser.py#L138" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>calc_ctrlg_ratio</code>(<strong><code>rpl</code></strong>:<code>Replay</code>, <strong><code>pid</code></strong>:<code>int</code>)</p>
</blockquote>
<p>Calculates the ratio between <code>ControlGroupEvents</code> and the union of
the <code>CommandEvents</code>, <code>SelectionEvents</code> and <code>ControlGroupCommand</code> sets
to quantify the players' level of awareness and use of this tactical
feature.</p>
<p><em>Args</em></p>

<pre><code>- rpl (sc2reader.resources.Replay)
    The replay being analysed.
- pid (int)
    In-game player ID of the player being considered in the
    analysis.

</code></pre>
<p><em>Returns</em></p>

<pre><code>- (dict[str, float])</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">calc_ctrlg_ratio</span><span class="p">(</span><span class="n">TEST_MATCH</span><span class="p">,</span> <span class="n">TEST_PID</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;ctrlg_ratio&#39;: 0.19630484988452657}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The next two functions use the union between <code>GetControlGroupEvent</code> and <code>SelectEvent</code> sets to quantify if the player preferes to select units based on mouse clicks or using control groups.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="calc_get_ctrl_grp_ratio" class="doc_header"><code>calc_get_ctrl_grp_ratio</code><a href="https://github.com/HDavidEspinosa/sc_training/tree/master/sc_training/ingest/selection_parser.py#L177" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>calc_get_ctrl_grp_ratio</code>(<strong><code>rpl</code></strong>:<code>Replay</code>, <strong><code>pid</code></strong>:<code>int</code>)</p>
</blockquote>
<p>Calculates the ratio between <code>GetControlGroupEvent</code> to the all
section events (i.e. the union of <code>GetControlGroupEvent</code> and
<code>SelectEvent</code>).</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="/sc_training/selection_parser.html#calc_get_ctrl_grp_ratio"><code>calc_get_ctrl_grp_ratio</code></a> sample run:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">calc_get_ctrl_grp_ratio</span><span class="p">(</span><span class="n">TEST_MATCH</span><span class="p">,</span> <span class="n">TEST_PID</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;get_ctrl_grp_ratio&#39;: 0.308}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="calc_select_ratio" class="doc_header"><code>calc_select_ratio</code><a href="https://github.com/HDavidEspinosa/sc_training/tree/master/sc_training/ingest/selection_parser.py#L197" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>calc_select_ratio</code>(<strong><code>rpl</code></strong>:<code>Replay</code>, <strong><code>pid</code></strong>:<code>int</code>)</p>
</blockquote>
<p>Calculates the ratio between <code>SelectEvent</code> to the all
section events (i.e. the union of <code>GetControlGroupEvent</code> and
<code>SelectEvent</code>).</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="/sc_training/selection_parser.html#calc_select_ratio"><code>calc_select_ratio</code></a> sample run:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">calc_select_ratio</span><span class="p">(</span><span class="n">TEST_MATCH</span><span class="p">,</span> <span class="n">TEST_PID</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;select_ratio&#39;: 0.716}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="References">References<a class="anchor-link" href="#References"> </a></h2><ul>
<li>Kim, G. (2015) 'sc2reader Documentation'. Available at: <a href="https://sc2reader.readthedocs.io/_/downloads/en/latest/pdf/">https://sc2reader.readthedocs.io/_/downloads/en/latest/pdf/</a>.</li>
</ul>

</div>
</div>
</div>
</div>
 

